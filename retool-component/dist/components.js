var le=Object.create;var $t=Object.defineProperty;var de=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var pe=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var ge=(n,s)=>()=>(s||n((s={exports:{}}).exports,s),s.exports);var fe=(n,s,d,m)=>{if(s&&typeof s=="object"||typeof s=="function")for(let g of ce(s))!ue.call(n,g)&&g!==d&&$t(n,g,{get:()=>s[g],enumerable:!(m=de(s,g))||m.enumerable});return n};var me=(n,s,d)=>(d=n!=null?le(pe(n)):{},fe(s||!n||!n.__esModule?$t(d,"default",{value:n,enumerable:!0}):d,n));var Ut=ge((Be,jt)=>{jt.exports=window.ccc_support_React});var p=me(Ut());var{Retool:x}=window.ccc_support_RetoolCustomComponenCollections;var{Fragment:dt,jsxs:c,jsx:r,default:Re}=window.ccc_support_ReactJSXRuntime;var he=n=>{if(n==null||n===""||n==="nan")return"";let s=String(n);if(/^\d{4}-\d{2}-\d{2}/.test(s)){let d=new Date(s);if(!isNaN(d.getTime()))return d.toLocaleDateString("en-GB",{day:"2-digit",month:"short"})}return s},P=(n,s)=>n?(typeof n=="string"?n:String(n)).replace(/\{(\w+)\}/g,(m,g)=>he(s[g])):"",ye=(n,s)=>{let d=typeof n=="string"?n:String(n||""),m=P(d,s),g=d.replace(/\{(\w+)\}/g,"");return m.trim()===g.trim()||m.trim()===""},q=36e5,mt=n=>{if(!n)return null;let s=n.split("-").map(Number);return s.length!==3?null:new Date(s[0],s[1]-1,s[2],0,0,0,0)},be=n=>{let s=new Date(n);return s.setHours(0,0,0,0),s},qt=n=>n.getDay()!==0&&n.getDay()!==6,Et=(n,s)=>{let d=new Date(n);for(d.setHours(s,0,0,0);d.getDay()===0||d.getDay()===6;)d.setDate(d.getDate()+1);return d},et=(n,s,d,m)=>{let g=new Date(n);!qt(g)||g.getHours()>=m?g=Et(new Date(g.getTime()+q*12),d):g.getHours()<d&&g.setHours(d,0,0,0);let M=s,E=new Date(g);for(;M>0;){if(!qt(E)){E=Et(new Date(E.getTime()+q*12),d);continue}let O=m-E.getHours(),V=Math.min(M,O);E.setTime(E.getTime()+V*q),M-=V,M>0&&(E=Et(new Date(E.getTime()+q*12),d))}return E},ve=(n,s)=>{let d=[],m=new Date(n);for(let g=0;g<s;g++)d.push(new Date(m)),m.setDate(m.getDate()+1);return d},xe=(n,s)=>{let d=[],m=new Date(n);for(;m.getDay()!==1;)m.setDate(m.getDate()-1);let g=new Date(n);for(g.setDate(g.getDate()+s);m<g;)d.push(new Date(m)),m.setDate(m.getDate()+7);return d},L=(n,s)=>(s.getTime()-n.getTime())/q,De=n=>`W/C ${n.toLocaleDateString("en-GB",{day:"2-digit",month:"short"})}`,Se=n=>{if(!n||n==="nan")return"In Progress";let s=n.toLowerCase().trim();return s==="ready"?"Ready":s==="parts not assigned"?"Parts Not Assigned":"In Progress"},Fe=(n,s=null)=>{let d=Se(n.part_status);if(d==="Ready")return"Ready";if(d==="Parts Not Assigned")return"Parts Not Assigned";if(s&&n.part_ready_date){let m=mt(n.part_ready_date),g=be(s);if(m&&g)return m.getTime()>g.getTime()?"Delayed":"On Time"}return"In Progress"},ct=n=>n.status==="Running",Bt={Running:"#9333EA",Ready:"#22C55E","On Time":"#E5A00D",Delayed:"#EF4444","Parts Not Assigned":"#9CA3AF","In Progress":"#D1D5DB"},Gt={Running:"#7E22CE",Ready:"#16A34A","On Time":"#B45309",Delayed:"#DC2626","Parts Not Assigned":"#6B7280","In Progress":"#9CA3AF"},nt=n=>Bt[n]||Bt["In Progress"],ht=n=>Gt[n]||Gt["In Progress"],ft=(n,s=null)=>ct(n)?"Running":Fe(n,s),_t=n=>{let d=Math.max(0,Math.min(100,typeof n=="number"?n:50));return d<=30?"#6B7280":d<=60?"#F59E0B":d<=80?"#EA580C":"#DC2626"};var h={container:{display:"flex",height:"100%",background:"#F9FAFB",overflow:"hidden",fontFamily:"'DM Sans', sans-serif"},sidebar:{width:320,minWidth:320,background:"#FFFFFF",borderRight:"1px solid #E5E7EB",display:"flex",flexDirection:"column"},mono:{fontFamily:"'JetBrains Mono', monospace"}},Yt=()=>c("div",{style:{position:"absolute",top:2,bottom:2,width:3,background:"#3B82F6",borderRadius:2,zIndex:30,boxShadow:"0 0 12px #3B82F6, 0 0 4px #3B82F6",pointerEvents:"none"},children:[r("div",{style:{position:"absolute",top:-4,left:-4,width:11,height:11,borderRadius:"50%",background:"#3B82F6"}}),r("div",{style:{position:"absolute",bottom:-4,left:-4,width:11,height:11,borderRadius:"50%",background:"#3B82F6"}})]}),we=()=>c("div",{style:{padding:"10px 16px",borderTop:"1px solid #E5E7EB",background:"#F9FAFB"},children:[r("h3",{style:{...h.mono,fontSize:11,fontWeight:700,letterSpacing:"0.08em",textTransform:"uppercase",color:"#4B5563",marginBottom:6},children:"Status Key"}),r("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px 0"},children:["Running","Ready","On Time","Delayed","Parts Not Assigned"].map(n=>c("div",{style:{display:"flex",alignItems:"center",gap:6,width:"50%",minWidth:0},children:[r("div",{style:{width:4,height:14,background:Bt[n],borderRadius:2,flexShrink:0}}),r("span",{style:{...h.mono,fontSize:9,color:ht(n),fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:n.toUpperCase()})]},n))})]}),Jt=({testName:n,priority:s,status:d,tooltipLines:m,scheduled:g,wrapperStyle:M,children:E})=>{let[O,V]=p.default.useState(!1),[G,yt]=p.default.useState({x:0,y:0,bottom:0}),[ot,H]=p.default.useState(!1),rt=(0,p.useRef)(null),C=(0,p.useRef)(null),Y=(0,p.useRef)(null),pt=(0,p.useCallback)(()=>{if(C.current){let F=C.current.getBoundingClientRect();yt({x:F.left+F.width/2,y:F.top,bottom:F.bottom})}rt.current=window.setTimeout(()=>V(!0),400)},[]),w=(0,p.useCallback)(()=>{rt.current&&clearTimeout(rt.current),V(!1),H(!1)},[]);p.default.useLayoutEffect(()=>{O&&Y.current&&Y.current.getBoundingClientRect().top<0&&H(!0)},[O,G]);let J=m.split(`
`).filter(F=>{let f=F.split(":");return f.length<2?F.trim()!=="":f.slice(1).join(":").trim()!==""}),S=c("div",{style:{background:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:10,boxShadow:"0 4px 16px rgba(0,0,0,0.12), 0 1px 4px rgba(0,0,0,0.06)",padding:"12px 16px",maxWidth:300,minWidth:180},children:[r("div",{style:{fontSize:13,fontWeight:700,color:"#111827",marginBottom:6,lineHeight:1.3},children:n}),c("div",{style:{display:"flex",gap:10,alignItems:"center",marginBottom:8},children:[c("span",{style:{fontSize:13,fontWeight:700,color:_t(s)},children:["P",s]}),r("span",{style:{fontSize:11,fontWeight:700,color:ht(d),textTransform:"uppercase",letterSpacing:"0.05em",padding:"1px 6px",background:`${nt(d)}18`,borderRadius:4,border:`1px solid ${nt(d)}40`},children:d})]}),r("div",{style:{height:1,background:"#E5E7EB",margin:"0 -4px 8px"}}),J.map((F,f)=>{let $=F.indexOf(":");if($===-1)return r("div",{style:{fontSize:11,color:"#374151",marginBottom:3,lineHeight:1.4},children:F},f);let bt=F.slice(0,$).trim(),j=F.slice($+1).trim();return c("div",{style:{display:"flex",gap:6,fontSize:11,marginBottom:3,lineHeight:1.4},children:[c("span",{style:{color:"#6B7280",fontWeight:500,flexShrink:0},children:[bt,":"]}),r("span",{style:{color:"#111827",fontWeight:400},children:j})]},f)}),g&&c(dt,{children:[r("div",{style:{height:1,background:"#E5E7EB",margin:"6px -4px 6px"}}),c("div",{style:{display:"flex",gap:6,fontSize:11,marginBottom:2},children:[r("span",{style:{color:"#6B7280",fontWeight:500},children:"Starts:"}),r("span",{style:{color:"#111827"},children:g.start.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})})]}),c("div",{style:{display:"flex",gap:6,fontSize:11},children:[r("span",{style:{color:"#6B7280",fontWeight:500},children:"Ends:"}),r("span",{style:{color:"#111827"},children:g.end.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})})]})]})]}),Q=r("div",{style:{width:10,height:10,background:"#FFFFFF",border:"1px solid #E5E7EB",borderTop:"none",borderLeft:"none",transform:"rotate(45deg)",margin:"-6px auto 0"}}),N=r("div",{style:{width:10,height:10,background:"#FFFFFF",border:"1px solid #E5E7EB",borderBottom:"none",borderRight:"none",transform:"rotate(45deg)",margin:"0 auto -6px"}});return c("div",{ref:C,onMouseEnter:pt,onMouseLeave:w,style:M||{position:"relative"},children:[E,O&&r("div",{ref:Y,style:{position:"fixed",left:G.x,top:ot?G.bottom+8:G.y-8,transform:ot?"translate(-50%, 0)":"translate(-50%, -100%)",zIndex:1e3,pointerEvents:"none"},children:ot?c(dt,{children:[N,S]}):c(dt,{children:[S,Q]})})]})},Tt=n=>{let s=[];return n.forEach(d=>{d.tests.forEach((m,g)=>{s.push({test_id:m.id,test_stand_id:d.id,priority_order:g+1})})}),s},Qt=n=>JSON.stringify(n.map(s=>`${s.test_id}:${s.test_stand_id}:${s.priority_order}`).sort()),We=()=>{let[n]=x.useStateArray({name:"tests",initialValue:[],inspector:"text",label:"Tests Data",description:"Array of test objects from getSchedulerData query"}),[s]=x.useStateArray({name:"testStands",initialValue:[],inspector:"text",label:"Test Stands Data",description:"Array of test stand objects from getTestStands query"}),[d]=x.useStateEnumeration({name:"saveMode",initialValue:"batch",enumDefinition:["batch","live"],inspector:"segmented",label:"Save Mode",description:"batch = save button, live = emit on every change"}),[m]=x.useStateNumber({name:"changeoverHours",initialValue:3,inspector:"text",label:"Changeover Hours",description:"Hours for changeover between tests (work hours only)"}),[g]=x.useStateNumber({name:"workStart",initialValue:9,inspector:"text",label:"Work Start Hour"}),[M]=x.useStateNumber({name:"workEnd",initialValue:17,inspector:"text",label:"Work End Hour"}),[E]=x.useStateEnumeration({name:"defaultViewWeeks",initialValue:"4",enumDefinition:["2","4","8","12","24"],inspector:"segmented",label:"Default View"}),O=Number(E)||4,[V]=x.useStateString({name:"cardMainText",initialValue:"{name}",inspector:"text",label:"Card Title",description:"Template for card title. Use {fieldName} for data fields."}),[G]=x.useStateString({name:"cardSubText",initialValue:"Parts: {part_ready_date}",inspector:"text",label:"Card Subtitle",description:"Template for subtitle. Hidden when all fields are empty."}),[yt]=x.useStateString({name:"cardInfoRow",initialValue:"{owner} \xB7 {duration}h \xB7 P{priority}",inspector:"text",label:"Card Info Row",description:"Template for the info row shown on cards and bars."}),[ot]=x.useStateString({name:"tooltipTemplate",initialValue:`Notes: {notes}
Owner: {owner}
Priority: {priority}
Part Status: {part_status}
Parts Due: {part_ready_date}
Assigned Parts: {assigned_parts}`,inspector:"text",label:"Tooltip Template",description:"Template for hover tooltip. Use \\n for newlines."}),[,H]=x.useStateArray({name:"allocations",initialValue:[],inspector:"hidden",description:"Current allocation state: [{test_id, test_stand_id, priority_order}]"}),[,rt]=x.useStateArray({name:"allTestIds",initialValue:[],inspector:"hidden",description:"All test IDs managed by the scheduler (for the delete step in save)"}),[,C]=x.useStateBoolean({name:"hasUnsavedChanges",initialValue:!1,inspector:"hidden",description:"Whether there are unsaved allocation changes"}),Y=x.useEventCallback({name:"onSave"}),pt=x.useEventCallback({name:"onChange"});x.useComponentSettings({defaultHeight:600,defaultWidth:12});let[w,J]=p.default.useState([]),[S,Q]=p.default.useState([]),[N,F]=p.default.useState(O||4),[f,$]=p.default.useState(null),[bt,j]=p.default.useState(null),[vt,K]=p.default.useState(null),[k,xt]=p.default.useState(!1),Rt=(0,p.useRef)(""),Kt=(0,p.useRef)(null),[st,Xt]=p.default.useState("az"),[it,Ct]=p.default.useState(""),Zt=(0,p.useMemo)(()=>JSON.stringify(n)+JSON.stringify(s),[n,s]);(0,p.useEffect)(()=>{let t=Array.isArray(n)?n:[],i=Array.isArray(s)?s:[];if(i.length===0&&t.length===0)return;let o=new Map;i.forEach(a=>o.set(a.id,{id:a.id,name:a.name,tests:[]}));let u=[];t.forEach(a=>{let D={id:a.id,name:a.name||"",duration:a.duration||72,owner:a.owner||"",priority:a.priority??50,notes:a.notes||"",status:a.status||"",test_stand_id:a.test_stand_id,priority_order:a.priority_order,allocation_id:a.allocation_id,assigned_parts:a.assigned_parts||null,part_ready_date:a.part_ready_date||null,part_status:a.part_status||"",...a};D.test_stand_id!=null&&o.has(D.test_stand_id)?o.get(D.test_stand_id).tests.push(D):u.push(D)}),o.forEach(a=>{a.tests.sort((D,U)=>(D.priority_order||999)-(U.priority_order||999))});let e=i.map(a=>o.get(a.id));J(e),Q(u),xt(!1);let l=Tt(e);Rt.current=Qt(l),H(l),rt(t.map(a=>a.id)),C(!1)},[Zt]);let A=m||3,W=g||9,I=M||17,b=(0,p.useMemo)(()=>{let t=new Date;for(t.setHours(0,0,0,0);t.getDay()!==1;)t.setDate(t.getDate()-1);return t},[]),Dt=(0,p.useCallback)(t=>{let i=t.filter(y=>ct(y)),o=t.filter(y=>!ct(y)),u=[...i].sort((y,R)=>{let B=mt(y.test_started_date)||new Date,_=mt(R.test_started_date)||new Date;return B.getTime()!==_.getTime()?B.getTime()-_.getTime():(R.priority??50)-(y.priority??50)}),e=new Date(b),l=u.map(y=>{let R=mt(y.test_started_date)||new Date(b),B=R<e?new Date(e):new Date(R),_=new Date(B.getTime()+y.duration*q);return e=et(_,A,W,I),{...y,start:B,end:_}}),a=et(new Date,A,W,I),D=new Date(Math.max(e.getTime(),a.getTime())),U=o.map(y=>{let R=new Date(D),B=new Date(R.getTime()+y.duration*q);return D=et(B,A,W,I),{...y,start:R,end:B}});return[...l,...U]},[b,A,W,I]),kt=(0,p.useMemo)(()=>{let t=new Date(b);return t.setDate(t.getDate()+N*7),w.forEach(i=>{let o=Dt(i.tests);if(o.length>0){let u=o[o.length-1],e=et(u.end,A,W,I);e>t&&(t=e)}}),t.setDate(t.getDate()+7),t},[w,b,N,A,W,I,Dt]),X=(0,p.useMemo)(()=>Math.ceil(L(b,kt)/24),[b,kt]),T=800/(N*7*24),St=(0,p.useMemo)(()=>ve(b,X),[b,X]),te=(0,p.useMemo)(()=>xe(b,X),[b,X]),At=X*24*T,at=24*T,ut=(0,p.useCallback)(t=>{let i=Tt(t),o=Qt(i)!==Rt.current;xt(o),H(i),C(o),d==="live"&&pt()},[d,H,C,pt]),lt=(0,p.useCallback)(t=>{let i=S.find(o=>o.id===t);if(i)return i;for(let o of w){let u=o.tests.find(e=>e.id===t);if(u)return u}return null},[S,w]),Z=(0,p.useCallback)(()=>{$(null),j(null),K(null)},[]),gt=(0,p.useCallback)((t,i)=>{if(!f)return;let o=lt(f);if(!o)return;Q(e=>e.filter(l=>l.id!==f));let u=w.map(e=>{let l=e.tests.filter(a=>a.id!==f);if(e.id===t){let a=[...l];return a.splice(i,0,o),{...e,tests:a}}return{...e,tests:l}});J(u),ut(u),Z()},[f,lt,w,ut,Z]),Ft=(0,p.useCallback)(t=>{if(!f)return;let i=lt(f);if(!i)return;let o=w.map(u=>({...u,tests:u.tests.filter(e=>e.id!==f)}));Q(u=>{let l=[...u.filter(a=>a.id!==f)];return l.splice(t,0,i),l}),J(o),ut(o),Z()},[f,lt,w,ut,Z]),ee=(0,p.useCallback)(()=>{Y()},[Y]),ne=(0,p.useCallback)(()=>{let t=Array.isArray(n)?n:[],i=Array.isArray(s)?s:[],o=new Map;i.forEach(l=>o.set(l.id,{id:l.id,name:l.name,tests:[]}));let u=[];t.forEach(l=>{let a={...l,duration:l.duration||72,priority:l.priority??50};a.test_stand_id!=null&&o.has(a.test_stand_id)?o.get(a.test_stand_id).tests.push(a):u.push(a)}),o.forEach(l=>l.tests.sort((a,D)=>(a.priority_order||999)-(D.priority_order||999)));let e=i.map(l=>o.get(l.id));J(e),Q(u),xt(!1),H(Tt(e)),C(!1)},[n,s,H,C]),Wt=(0,p.useCallback)((t,i)=>({left:Math.max(0,L(b,t))*T,width:Math.max(i*T,2)}),[b,T]),oe=(0,p.useCallback)((t,i)=>{let o=Math.max(t.getTime(),b.getTime()),u=i.getTime();return u<=o?null:{left:L(b,new Date(o))*T,width:Math.max(L(new Date(o),new Date(u))*T,2)}},[b,T]),It=f!=null?lt(f):null,tt=It!=null?ct(It):!1,zt=w.reduce((t,i)=>t+i.tests.length,0),re=w.reduce((t,i)=>t+i.tests.reduce((o,u)=>o+u.duration,0),0),wt=String(V||"{name}"),Pt=String(G||""),Mt=String(yt||""),Ht=String(ot||"").replace(/\\n/g,`
`),Nt={Running:0,Delayed:1,"On Time":2,Ready:3,"In Progress":4,"Parts Not Assigned":5},se=(0,p.useMemo)(()=>{let t=[...S];if(it.trim()){let i=it.toLowerCase().trim();t=t.filter(o=>[o.name,o.owner,o.notes,o.status,o.part_status,o.assigned_parts,o.priority!=null?String(o.priority):"",o.duration!=null?String(o.duration):""].join(" ").toLowerCase().includes(i))}return st==="az"?t.sort((i,o)=>(i.name||"").localeCompare(o.name||"")):st==="priority"?t.sort((i,o)=>(o.priority??50)-(i.priority??50)):t.sort((i,o)=>{let u=Nt[ft(i)]??99,e=Nt[ft(o)]??99;return u!==e?u-e:(o.priority??50)-(i.priority??50)}),t},[S,st,it]),ie=72,Lt=84;return c("div",{style:h.container,children:[c("div",{style:h.sidebar,children:[c("div",{style:{padding:"20px 16px 12px",borderBottom:"1px solid #E5E7EB"},children:[c("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[c("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r("div",{style:{width:8,height:8,borderRadius:"50%",background:S.length>0?"#F59E0B":"#10B981"}}),r("span",{style:{...h.mono,fontSize:13,fontWeight:700,letterSpacing:"0.08em",textTransform:"uppercase",color:"#4B5563"},children:"Queue"})]}),r("div",{style:{display:"flex",gap:2,background:"#F3F4F6",borderRadius:6,padding:2,border:"1px solid #E5E7EB"},children:[["az","A\u2192Z"],["priority","Priority"],["status","Status"]].map(([t,i])=>r("button",{onClick:()=>Xt(t),style:{...h.mono,padding:"3px 8px",fontSize:9,fontWeight:600,borderRadius:4,border:"none",cursor:"pointer",background:st===t?"#3B82F6":"transparent",color:st===t?"#FFF":"#6B7280"},children:i},t))})]}),c("div",{style:{position:"relative",marginTop:6},children:[r("input",{type:"text",value:it,onChange:t=>Ct(t.target.value),placeholder:"Filter tests...",style:{...h.mono,width:"100%",boxSizing:"border-box",padding:"5px 28px 5px 8px",fontSize:11,border:"1px solid #E5E7EB",borderRadius:6,background:"#F9FAFB",color:"#111827",outline:"none"},onFocus:t=>{t.currentTarget.style.borderColor="#3B82F6",t.currentTarget.style.background="#FFFFFF"},onBlur:t=>{t.currentTarget.style.borderColor="#E5E7EB",t.currentTarget.style.background="#F9FAFB"}}),it&&r("button",{onClick:()=>Ct(""),style:{position:"absolute",right:6,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",fontSize:14,lineHeight:1,padding:0},children:"\xD7"})]})]}),c("div",{style:{flex:1,overflowY:"auto",padding:"8px 10px"},onDragOver:t=>{t.preventDefault(),t.target===t.currentTarget&&K(S.length)},onDragLeave:t=>{t.currentTarget===t.target&&K(null)},onDrop:t=>{t.preventDefault(),Ft(vt??S.length)},children:[se.map((t,i)=>{let o=ft(t,null),u=!ye(Pt,t);return c("div",{children:[r("div",{onDragOver:e=>{e.preventDefault(),e.stopPropagation(),K(i)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),Ft(i)},style:{height:vt===i&&f&&f!==t.id?6:0,background:"#3B82F6",borderRadius:3,transition:"height 0.12s ease"}}),r(Jt,{testName:P(wt,t),priority:t.priority,status:o,tooltipLines:P(Ht,t),children:c("div",{draggable:!0,onDragStart:e=>{e.dataTransfer.effectAllowed="move",$(t.id)},onDragEnd:Z,onDragOver:e=>{e.preventDefault(),e.stopPropagation();let l=e.currentTarget.getBoundingClientRect();K(e.clientY<l.top+l.height/2?i:i+1)},onMouseEnter:e=>{let l=e.currentTarget;l.style.transform="translateY(-2px)",l.style.boxShadow="0 4px 12px rgba(0,0,0,0.15)",l.style.border=`2px solid ${nt(o)}`},onMouseLeave:e=>{let l=e.currentTarget;l.style.transform="translateY(0)",l.style.boxShadow="0 1px 3px rgba(0,0,0,0.06)",l.style.border="1px solid #E5E7EB"},style:{display:"flex",marginBottom:6,background:f===t.id?"#F3F4F6":"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:8,cursor:"grab",opacity:f===t.id?.35:1,overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.06)",transition:"transform 0.15s ease, box-shadow 0.15s ease, border 0.15s ease"},children:[r("div",{style:{width:5,minWidth:5,background:nt(o),borderRadius:"8px 0 0 8px",flexShrink:0}}),c("div",{style:{flex:1,padding:"8px 12px",minWidth:0},children:[c("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[c("span",{style:{...h.mono,fontSize:13,fontWeight:700,color:_t(t.priority)},children:["P",t.priority]}),r("span",{style:{...h.mono,fontSize:11,fontWeight:700,letterSpacing:"0.05em",color:ht(o),textTransform:"uppercase"},children:o.toUpperCase()})]}),r("div",{style:{fontSize:14,fontWeight:600,color:"#111827",marginBottom:2,lineHeight:1.3},children:P(wt,t)}),u&&r("div",{style:{...h.mono,fontSize:11,color:"#6B7280",marginBottom:4,fontWeight:400},children:P(Pt,t)}),r("div",{style:{...h.mono,display:"flex",gap:8,fontSize:11,color:"#4B5563",flexWrap:"wrap"},children:P(Mt,t).split("\xB7").map((e,l,a)=>c(p.default.Fragment,{children:[r("span",{children:e.trim()}),l<a.length-1&&r("span",{children:"\xB7"})]},l))})]})]})})]},t.id)}),r("div",{onDragOver:t=>{t.preventDefault(),K(S.length)},onDrop:t=>{t.preventDefault(),Ft(S.length)},style:{height:vt===S.length&&f?6:0,background:"#3B82F6",borderRadius:3,transition:"height 0.12s ease",margin:"0 4px"}}),S.length===0&&r("div",{style:{textAlign:"center",padding:"32px 16px",color:"#6B7280",fontSize:12,border:f?"2px dashed #3B82F6":"2px dashed #D1D5DB",borderRadius:8,marginTop:8,background:f?"#EFF6FF":"transparent"},children:f?"Drop to return to queue":"All tests allocated"})]}),r(we,{}),r("div",{style:{padding:"12px 16px",borderTop:"1px solid #E5E7EB",background:"#F9FAFB"},children:c("div",{style:{...h.mono,display:"flex",justifyContent:"space-between",fontSize:10,color:"#6B7280"},children:[c("span",{children:[zt,"/",zt+S.length," allocated"]}),c("span",{children:[re,"h"]})]})})]}),c("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[c("div",{style:{padding:"12px 24px",borderBottom:"1px solid #E5E7EB",background:"#FFFFFF",display:"flex",alignItems:"center",justifyContent:"space-between",gap:16,flexWrap:"wrap"},children:[c("div",{style:{minWidth:0},children:[r("h1",{style:{fontSize:18,fontWeight:700,color:"#111827",letterSpacing:"-0.02em"},children:"Test Stand Scheduler"}),c("p",{style:{...h.mono,fontSize:11,color:"#6B7280",marginTop:2},children:["Continuous testing \xB7 ",A,"h changeover (",W,":00\u2013",I,":00 Mon\u2013Fri)",d==="live"&&r("span",{children:" \xB7 Live sync"})]})]}),c("div",{style:{display:"flex",alignItems:"center",gap:12},children:[d==="batch"&&c("div",{style:{display:"flex",gap:6},children:[r("button",{onClick:ne,disabled:!k,style:{...h.mono,padding:"6px 14px",fontSize:11,fontWeight:600,borderRadius:6,border:"1px solid #D1D5DB",cursor:k?"pointer":"default",background:"#FFFFFF",color:k?"#374151":"#9CA3AF",opacity:k?1:.5},children:"Discard"}),c("button",{onClick:ee,disabled:!k,style:{...h.mono,padding:"6px 14px",fontSize:11,fontWeight:600,borderRadius:6,border:"none",cursor:k?"pointer":"default",background:k?"#3B82F6":"#93C5FD",color:"#FFFFFF",boxShadow:k?"0 1px 3px rgba(59,130,246,0.3)":"none"},children:["Save Changes",k&&" \u2022"]})]}),r("div",{style:{display:"flex",gap:4,background:"#F3F4F6",borderRadius:8,padding:3,border:"1px solid #E5E7EB"},children:[2,4,8,12,24].map(t=>c("button",{onClick:()=>F(t),style:{...h.mono,padding:"6px 12px",fontSize:11,fontWeight:600,borderRadius:6,border:"none",cursor:"pointer",background:N===t?"#3B82F6":"transparent",color:N===t?"#FFF":"#4B5563"},children:[t,"W"]},t))})]})]}),r("div",{ref:Kt,style:{flex:1,overflow:"auto",background:"#F9FAFB"},children:c("div",{style:{minWidth:At,padding:"0 12px 24px",position:"relative"},children:[c("div",{style:{position:"sticky",top:0,zIndex:20,background:"#F9FAFB",borderBottom:"1px solid #E5E7EB"},children:[r("div",{style:{display:"flex",height:28,position:"relative",borderBottom:"1px solid #E5E7EB"},children:te.map((t,i)=>r("div",{style:{...h.mono,position:"absolute",left:L(b,t)*T,width:7*24*T,height:28,display:"flex",alignItems:"center",paddingLeft:8,fontSize:10,fontWeight:600,color:"#4B5563",borderLeft:i>0?"1px solid #E5E7EB":"none"},children:De(t)},i))}),r("div",{style:{display:"flex",height:24},children:St.map((t,i)=>{let o=t.toDateString()===new Date().toDateString(),u=t.getDay()===0||t.getDay()===6;return r("div",{style:{...h.mono,width:at,minWidth:at,fontSize:9,textAlign:"center",color:o?"#2563EB":"#6B7280",fontWeight:o?700:400,lineHeight:"24px",borderLeft:"1px solid #E5E7EB",background:o?"#EFF6FF":u?"#F3F4F6":"transparent"},children:N<=8||t.getDay()===1?t.getDate():""},i)})})]}),w.map(t=>{let i=Dt(t.tests),o=bt,u=o&&o.standId===t.id;return c("div",{style:{marginTop:16},children:[c("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6,paddingLeft:2},children:[r("div",{style:{width:6,height:6,borderRadius:2,background:t.tests.length>0?"#3B82F6":"#9CA3AF"}}),r("span",{style:{...h.mono,fontSize:11,fontWeight:600,color:"#374151"},children:t.name}),c("span",{style:{...h.mono,fontSize:10,color:"#6B7280"},children:[t.tests.length," test",t.tests.length!==1?"s":"",t.tests.length>0&&` \xB7 ${t.tests.reduce((e,l)=>e+l.duration,0)}h`]})]}),c("div",{onDragOver:e=>{e.preventDefault(),j({standId:t.id,index:t.tests.length})},onDragLeave:e=>{e.currentTarget.contains(e.relatedTarget)||j(null)},onDrop:e=>{e.preventDefault(),tt?gt(t.id,t.tests.length):gt(t.id,o?.standId===t.id?o.index:t.tests.length)},style:{position:"relative",height:Lt,background:(()=>u||f&&t.tests.length===0?tt?"#F5F3FF":"#EFF6FF":"#F3F4F6")(),border:`1px solid ${(()=>u||f&&t.tests.length===0?tt?"#A78BFA":"#BFDBFE":"#E5E7EB")()}`,borderRadius:8,width:At,transition:"background 0.15s ease, border-color 0.15s ease"},children:[St.map((e,l)=>e.getDay()!==0&&e.getDay()!==6?null:r("div",{style:{position:"absolute",left:l*at,top:0,bottom:0,width:at,background:"#E5E7EB",pointerEvents:"none"}},`we-${l}`)),St.map((e,l)=>r("div",{style:{position:"absolute",left:l*at,top:0,bottom:0,width:1,background:"#E5E7EB"}},l)),(()=>{let e=L(b,new Date);return e<0||e>X*24?null:r("div",{style:{position:"absolute",left:e*T,top:0,bottom:0,width:2,background:"#EF4444",zIndex:10},children:r("div",{style:{position:"absolute",top:-3,left:-3,width:8,height:8,borderRadius:"50%",background:"#EF4444"}})})})(),i.map((e,l)=>{let a=ct(e),D=a?oe(e.start,e.end):Wt(e.start,e.duration);if(!D)return null;let{left:U,width:y}=D,R=et(e.end,A,W,I),B=L(e.end,R)*T,_=ft(e,e.start),Ot=P(wt,e),Vt=P(Mt,e),ae=Vt.trim()!==""&&y>120;return c("div",{style:{position:"absolute",left:U,top:0,width:y+B,height:"100%"},children:[f&&f!==e.id&&!tt&&c(dt,{children:[r("div",{onDragOver:v=>{v.preventDefault(),v.stopPropagation(),j({standId:t.id,index:l})},onDrop:v=>{v.preventDefault(),v.stopPropagation(),gt(t.id,l)},style:{position:"absolute",left:-6,top:0,width:"50%",height:"100%",zIndex:20,minWidth:20}}),r("div",{onDragOver:v=>{v.preventDefault(),v.stopPropagation(),j({standId:t.id,index:l+1})},onDrop:v=>{v.preventDefault(),v.stopPropagation(),gt(t.id,l+1)},style:{position:"absolute",right:-6,top:0,width:"50%",height:"100%",zIndex:20,minWidth:20}})]}),u&&!tt&&o.index===l&&r("div",{style:{position:"absolute",left:-4,top:0,bottom:0},children:r(Yt,{})}),r(Jt,{testName:Ot,priority:e.priority,status:_,tooltipLines:P(Ht,e),scheduled:a?null:e,wrapperStyle:{position:"absolute",left:0,top:0,width:y,height:"100%"},children:c("div",{draggable:!0,onDragStart:v=>{v.dataTransfer.effectAllowed="move",v.dataTransfer.setData("text/plain",String(e.id)),$(e.id)},onDragEnd:Z,onMouseEnter:v=>{if(!f){let z=v.currentTarget;z.style.transform="translateY(-2px)",z.style.boxShadow="0 4px 12px rgba(0,0,0,0.15)",z.style.border=`2px solid ${nt(_)}`,z.style.zIndex="25"}},onMouseLeave:v=>{let z=v.currentTarget;z.style.transform="translateY(0)",z.style.boxShadow="0 1px 3px rgba(0,0,0,0.06)",z.style.border=a?"1px solid #C4B5FD":"1px solid #E5E7EB",z.style.zIndex="15"},style:{position:"absolute",left:0,top:6,width:y,height:ie,background:a?"#F3E8FF":"#FFFFFF",borderRadius:8,cursor:"grab",display:"flex",flexDirection:"row",overflow:"hidden",opacity:f===e.id?.25:1,zIndex:15,border:a?"1px solid #C4B5FD":"1px solid #E5E7EB",boxShadow:a?"0 1px 3px rgba(147,51,234,0.15)":"0 1px 3px rgba(0,0,0,0.06)",transition:"transform 0.15s ease, box-shadow 0.15s ease, border 0.15s ease"},children:[r("div",{style:{width:5,minWidth:5,background:nt(_),flexShrink:0}}),c("div",{style:{flex:1,display:"flex",flexDirection:"column",padding:"4px 8px",minWidth:0,justifyContent:"center"},children:[y>70&&c("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2},children:[r("span",{style:{...h.mono,fontSize:y>120?11:9,fontWeight:700,color:a?"#7E22CE":_t(e.priority)},children:a?"\u25B6 RUNNING":`P${e.priority}`}),y>100&&!a&&r("span",{style:{...h.mono,fontSize:9,fontWeight:700,letterSpacing:"0.05em",color:ht(_),textTransform:"uppercase"},children:_.toUpperCase()})]}),r("span",{style:{fontSize:y>120?12:y>80?11:10,fontWeight:600,color:a?"#3B0764":"#111827",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",lineHeight:1.2},children:Ot}),ae&&r("span",{style:{...h.mono,fontSize:9,fontWeight:400,color:a?"#7E22CE":"#4B5563",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",marginTop:2},children:Vt})]})]})}),l<i.length&&B>0&&r("div",{style:{position:"absolute",left:y,top:Lt/2-8,width:B,height:16,display:"flex",alignItems:"center",justifyContent:"center"},children:r("div",{style:{height:1,width:"80%",background:"repeating-linear-gradient(90deg, #9CA3AF 0, #9CA3AF 4px, transparent 4px, transparent 8px)"}})})]},e.id)}),u&&!tt&&o.index===t.tests.length&&i.length>0&&(()=>{let e=i[i.length-1],{left:l,width:a}=Wt(e.start,e.duration),D=et(e.end,A,W,I),U=L(e.end,D)*T;return r("div",{style:{position:"absolute",left:l+a+U+8,top:0,bottom:0},children:r(Yt,{})})})(),t.tests.length===0&&r("div",{style:{...h.mono,position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,color:f?"#3B82F6":"#9CA3AF",fontWeight:f?600:400},children:f?"Drop here to schedule":"Drop tests here to schedule"})]})]},t.id)}),w.length===0&&r("div",{style:{...h.mono,textAlign:"center",padding:"48px 24px",color:"#6B7280",fontSize:12},children:"No test stands loaded. Bind the testStands property to your getTestStands query."})]})})]})]})};export{We as TestStandScheduler};
