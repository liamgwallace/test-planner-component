var ae=Object.create;var Lt=Object.defineProperty;var de=Object.getOwnPropertyDescriptor;var le=Object.getOwnPropertyNames;var ce=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var pe=(e,o)=>()=>(o||e((o={exports:{}}).exports,o),o.exports);var ge=(e,o,a,f)=>{if(o&&typeof o=="object"||typeof o=="function")for(let p of le(o))!ue.call(e,p)&&p!==a&&Lt(e,p,{get:()=>o[p],enumerable:!(f=de(o,p))||f.enumerable});return e};var fe=(e,o,a)=>(a=e!=null?ae(ce(e)):{},ge(o||!e||!e.__esModule?Lt(a,"default",{value:e,enumerable:!0}):a,e));var Nt=pe((ke,Ht)=>{Ht.exports=window.ccc_support_React});var c=fe(Nt());var{Retool:F}=window.ccc_support_RetoolCustomComponenCollections;var{Fragment:dt,jsxs:i,jsx:n,default:_e}=window.ccc_support_ReactJSXRuntime;var me=e=>{if(e==null||e===""||e==="nan")return"";let o=String(e);if(/^\d{4}-\d{2}-\d{2}/.test(o)){let a=new Date(o);if(!isNaN(a.getTime()))return a.toLocaleDateString("en-GB",{day:"2-digit",month:"short"})}return o},L=(e,o)=>e?(typeof e=="string"?e:String(e)).replace(/\{(\w+)\}/g,(f,p)=>me(o[p])):"",he=(e,o)=>{let a=typeof e=="string"?e:String(e||""),f=L(a,o),p=a.replace(/\{(\w+)\}/g,"");return f.trim()===p.trim()||f.trim()===""},H=36e5,ye=e=>{if(!e)return null;let o=e.split("-").map(Number);return o.length!==3?null:new Date(o[0],o[1]-1,o[2],0,0,0,0)},be=e=>{let o=new Date(e);return o.setHours(0,0,0,0),o},Ot=e=>e.getDay()!==0&&e.getDay()!==6,Dt=(e,o)=>{let a=new Date(e);for(a.setHours(o,0,0,0);a.getDay()===0||a.getDay()===6;)a.setDate(a.getDate()+1);return a},J=(e,o,a,f)=>{let p=new Date(e);!Ot(p)||p.getHours()>=f?p=Dt(new Date(p.getTime()+H*12),a):p.getHours()<a&&p.setHours(a,0,0,0);let I=o,u=new Date(p);for(;I>0;){if(!Ot(u)){u=Dt(new Date(u.getTime()+H*12),a);continue}let B=f-u.getHours(),A=Math.min(I,B);u.setTime(u.getTime()+A*H),I-=A,I>0&&(u=Dt(new Date(u.getTime()+H*12),a))}return u},xe=(e,o)=>{let a=[],f=new Date(e);for(let p=0;p<o;p++)a.push(new Date(f)),f.setDate(f.getDate()+1);return a},ve=(e,o)=>{let a=[],f=new Date(e);for(;f.getDay()!==1;)f.setDate(f.getDate()-1);let p=new Date(e);for(p.setDate(p.getDate()+o);f<p;)a.push(new Date(f)),f.setDate(f.getDate()+7);return a},K=(e,o)=>(o.getTime()-e.getTime())/H,De=e=>`W/C ${e.toLocaleDateString("en-GB",{day:"2-digit",month:"short"})}`,Se=e=>{if(!e||e==="nan")return"In Progress";let o=e.toLowerCase().trim();return o==="ready"?"Ready":o==="parts not assigned"?"Parts Not Assigned":"In Progress"},Vt=(e,o=null)=>{let a=Se(e.part_status);if(a==="Ready")return"Ready";if(a==="Parts Not Assigned")return"Parts Not Assigned";if(o&&e.part_ready_date){let f=ye(e.part_ready_date),p=be(o);if(f&&p)return f.getTime()>p.getTime()?"Delayed":"On Time"}return"In Progress"},$t={Ready:"#22C55E","On Time":"#E5A00D",Delayed:"#EF4444","Parts Not Assigned":"#9CA3AF","In Progress":"#D1D5DB"},qt={Ready:"#16A34A","On Time":"#B45309",Delayed:"#DC2626","Parts Not Assigned":"#6B7280","In Progress":"#9CA3AF"},N=e=>$t[e]||$t["In Progress"],Gt=e=>qt[e]||qt["In Progress"],we={"In Progress":"#F59E0B",Queued:"#6B7280",Ready:"#10B981",Delayed:"#EF4444",Waiting:"#8B5CF6",Complete:"#14B8A6"},Fe={"In Progress":"#92400E",Queued:"#374151",Ready:"#065F46",Delayed:"#991B1B",Waiting:"#5B21B6",Complete:"#134E4A"},X=e=>we[e]||"#6B7280",St=e=>Fe[e]||"#374151",$=e=>{let a=Math.max(0,Math.min(100,typeof e=="number"?e:50));return a<=30?"#6B7280":a<=60?"#F59E0B":a<=80?"#EA580C":"#DC2626"};var y={container:{position:"relative",display:"flex",height:"100%",background:"#F9FAFB",overflow:"hidden",fontFamily:"'DM Sans', sans-serif"},sidebar:{width:320,minWidth:320,background:"#FFFFFF",borderRight:"1px solid #E5E7EB",display:"flex",flexDirection:"column"},mono:{fontFamily:"'JetBrains Mono', monospace"}},jt=()=>i("div",{style:{position:"absolute",top:2,bottom:2,width:3,background:"#3B82F6",borderRadius:2,zIndex:30,boxShadow:"0 0 12px #3B82F6, 0 0 4px #3B82F6",pointerEvents:"none"},children:[n("div",{style:{position:"absolute",top:-4,left:-4,width:11,height:11,borderRadius:"50%",background:"#3B82F6"}}),n("div",{style:{position:"absolute",bottom:-4,left:-4,width:11,height:11,borderRadius:"50%",background:"#3B82F6"}})]}),Ee=()=>i("div",{style:{padding:"12px 16px",borderTop:"1px solid #E5E7EB",background:"#F9FAFB"},children:[n("h3",{style:{...y.mono,fontSize:11,fontWeight:700,letterSpacing:"0.08em",textTransform:"uppercase",color:"#4B5563",marginBottom:8},children:"Test Status"}),["In Progress","Queued","Ready","Delayed","Waiting","Complete"].map(e=>i("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:4},children:[n("div",{style:{width:4,height:16,background:X(e),borderRadius:2}}),n("span",{style:{...y.mono,fontSize:10,color:St(e),fontWeight:600},children:e})]},e))]}),Qt=({testName:e,priority:o,status:a,tooltipLines:f,scheduled:p,wrapperStyle:I,children:u})=>{let[B,A]=c.default.useState(!1),[q,gt]=c.default.useState({x:0,y:0,bottom:0}),[Z,lt]=c.default.useState(!1),tt=(0,c.useRef)(null),O=(0,c.useRef)(null),et=(0,c.useRef)(null),nt=(0,c.useCallback)(()=>{if(O.current){let D=O.current.getBoundingClientRect();gt({x:D.left+D.width/2,y:D.top,bottom:D.bottom})}tt.current=window.setTimeout(()=>A(!0),400)},[]),ct=(0,c.useCallback)(()=>{tt.current&&clearTimeout(tt.current),A(!1),lt(!1)},[]);c.default.useLayoutEffect(()=>{B&&et.current&&et.current.getBoundingClientRect().top<0&&lt(!0)},[B,q]);let T=f.split(`
`).filter(D=>{let V=D.split(":");return V.length<2?D.trim()!=="":V.slice(1).join(":").trim()!==""}),j=i("div",{style:{background:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:10,boxShadow:"0 4px 16px rgba(0,0,0,0.12), 0 1px 4px rgba(0,0,0,0.06)",padding:"12px 16px",maxWidth:300,minWidth:180},children:[n("div",{style:{fontSize:13,fontWeight:700,color:"#111827",marginBottom:6,lineHeight:1.3},children:e}),i("div",{style:{display:"flex",gap:10,alignItems:"center",marginBottom:8},children:[i("span",{style:{fontSize:13,fontWeight:700,color:$(o)},children:["P",o]}),n("span",{style:{fontSize:11,fontWeight:700,color:Gt(a),textTransform:"uppercase",letterSpacing:"0.05em",padding:"1px 6px",background:`${N(a)}18`,borderRadius:4,border:`1px solid ${N(a)}40`},children:a})]}),n("div",{style:{height:1,background:"#E5E7EB",margin:"0 -4px 8px"}}),T.map((D,V)=>{let m=D.indexOf(":");if(m===-1)return n("div",{style:{fontSize:11,color:"#374151",marginBottom:3,lineHeight:1.4},children:D},V);let ot=D.slice(0,m).trim(),ft=D.slice(m+1).trim();return i("div",{style:{display:"flex",gap:6,fontSize:11,marginBottom:3,lineHeight:1.4},children:[i("span",{style:{color:"#6B7280",fontWeight:500,flexShrink:0},children:[ot,":"]}),n("span",{style:{color:"#111827",fontWeight:400},children:ft})]},V)}),p&&i(dt,{children:[n("div",{style:{height:1,background:"#E5E7EB",margin:"6px -4px 6px"}}),i("div",{style:{display:"flex",gap:6,fontSize:11,marginBottom:2},children:[n("span",{style:{color:"#6B7280",fontWeight:500},children:"Starts:"}),n("span",{style:{color:"#111827"},children:p.start.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})})]}),i("div",{style:{display:"flex",gap:6,fontSize:11},children:[n("span",{style:{color:"#6B7280",fontWeight:500},children:"Ends:"}),n("span",{style:{color:"#111827"},children:p.end.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})})]})]})]}),C=n("div",{style:{width:10,height:10,background:"#FFFFFF",border:"1px solid #E5E7EB",borderTop:"none",borderLeft:"none",transform:"rotate(45deg)",margin:"-6px auto 0"}}),rt=n("div",{style:{width:10,height:10,background:"#FFFFFF",border:"1px solid #E5E7EB",borderBottom:"none",borderRight:"none",transform:"rotate(45deg)",margin:"0 auto -6px"}});return i("div",{ref:O,onMouseEnter:nt,onMouseLeave:ct,style:I||{position:"relative"},children:[u,B&&n("div",{ref:et,style:{position:"fixed",left:q.x,top:Z?q.bottom+8:q.y-8,transform:Z?"translate(-50%, 0)":"translate(-50%, -100%)",zIndex:1e3,pointerEvents:"none"},children:Z?i(dt,{children:[rt,j]}):i(dt,{children:[j,C]})})]})},Ut=e=>{let o=[];return e.forEach(a=>{a.tests.forEach((f,p)=>{o.push({test_id:f.id,test_stand_id:a.id,priority_order:p+1})})}),o},Yt=e=>JSON.stringify(e.map(o=>`${o.test_id}:${o.test_stand_id}:${o.priority_order}`).sort()),wt=class extends c.default.Component{constructor(o){super(o),this.state={error:null}}static getDerivedStateFromError(o){return{error:o}}render(){return this.state.error?i("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",padding:32,fontFamily:"monospace",fontSize:12,color:"#DC2626",background:"#FEF2F2",border:"1px solid #FECACA",borderRadius:8,flexDirection:"column",gap:8},children:[n("strong",{children:"Scheduler error"}),n("span",{style:{color:"#6B7280"},children:this.state.error.message})]}):this.props.children}},Te=(e,o)=>{let a=Array.isArray(o)?o:[],f=new Map;a.forEach(u=>f.set(u.id,{id:u.id,name:u.name,tests:[]}));let p=[];return(Array.isArray(e)?e:[]).forEach(u=>{let B={id:u.id,name:u.name||"",duration:u.duration||72,owner:u.owner||"",priority:u.priority??50,notes:u.notes||"",status:u.status||"",test_stand_id:u.test_stand_id,priority_order:u.priority_order,allocation_id:u.allocation_id,assigned_parts:u.assigned_parts||null,part_ready_date:u.part_ready_date||null,part_status:u.part_status||"",started_date:u.started_date||null,...u};B.test_stand_id!=null&&f.has(B.test_stand_id)?f.get(B.test_stand_id).tests.push(B):p.push(B)}),f.forEach(u=>{u.tests.sort((B,A)=>(B.priority_order||999)-(A.priority_order||999))}),{stands:a.map(u=>f.get(u.id)),unallocated:p}},ze=()=>{let[e]=F.useStateArray({name:"tests",initialValue:[],inspector:"text",label:"Tests Data",description:"Array of test objects from getSchedulerData query"}),[o]=F.useStateArray({name:"testStands",initialValue:[],inspector:"text",label:"Test Stands Data",description:"Array of test stand objects from getTestStands query"}),[a]=F.useStateEnumeration({name:"saveState",initialValue:"idle",enumDefinition:["idle","saving","error"],inspector:"segmented",label:"Save State",description:"idle = normal, saving = dims and locks the component, error = shows error banner. Wire this to your query loading/error states."}),[f]=F.useStateNumber({name:"changeoverHours",initialValue:3,inspector:"text",label:"Changeover Hours",description:"Hours for changeover between tests (work hours only)"}),[p]=F.useStateNumber({name:"workStart",initialValue:9,inspector:"text",label:"Work Start Hour"}),[I]=F.useStateNumber({name:"workEnd",initialValue:17,inspector:"text",label:"Work End Hour"}),[u]=F.useStateString({name:"inProgressStatus",initialValue:"In Progress",inspector:"text",label:"In-Progress Status Value",description:"The test status string that identifies currently-running tests."}),[B]=F.useStateString({name:"queuedStatus",initialValue:"Queued",inspector:"text",label:"Queued Status Value",description:"The test status string that identifies tests waiting to be scheduled."}),[A]=F.useStateEnumeration({name:"defaultViewWeeks",initialValue:"4",enumDefinition:["2","4","8","12","24"],inspector:"segmented",label:"Default View"}),q=Number(A)||4,[gt]=F.useStateString({name:"cardMainText",initialValue:"{name}",inspector:"text",label:"Card Title",description:"Template for card title. Use {fieldName} for data fields."}),[Z]=F.useStateString({name:"cardSubText",initialValue:"Parts: {part_ready_date}",inspector:"text",label:"Card Subtitle",description:"Template for subtitle. Hidden when all fields are empty."}),[lt]=F.useStateString({name:"cardInfoRow",initialValue:"{owner} \xB7 {duration}h \xB7 P{priority}",inspector:"text",label:"Card Info Row",description:"Template for the info row shown on cards and bars."}),[tt]=F.useStateString({name:"tooltipTemplate",initialValue:`Notes: {notes}
Owner: {owner}
Priority: {priority}
Part Status: {part_status}
Parts Due: {part_ready_date}
Assigned Parts: {assigned_parts}`,inspector:"text",label:"Tooltip Template",description:"Template for hover tooltip. Use \\n for newlines."}),[,O]=F.useStateArray({name:"allocations",initialValue:[],inspector:"hidden",description:"Current allocation state: [{test_id, test_stand_id, priority_order}]"}),[,et]=F.useStateArray({name:"allTestIds",initialValue:[],inspector:"hidden",description:"All test IDs managed by the scheduler (for the delete step in save)"}),[,nt]=F.useStateBoolean({name:"hasUnsavedChanges",initialValue:!1,inspector:"hidden",description:"Whether there are unsaved allocation changes"}),ct=F.useEventCallback({name:"onChange"});F.useComponentSettings({defaultHeight:600,defaultWidth:12});let[T,j]=c.default.useState([]),[C,rt]=c.default.useState([]),[D,V]=c.default.useState(q||4),[m,ot]=c.default.useState(null),[ft,st]=c.default.useState(null),[mt,Q]=c.default.useState(null),[Jt,Ft]=c.default.useState(!1),Et=(0,c.useRef)(""),Kt=(0,c.useRef)(null),Tt=(0,c.useRef)(null),[Xt,Zt]=c.default.useState(800),[U,Bt]=c.default.useState("az"),[it,Ct]=c.default.useState(""),te=(0,c.useMemo)(()=>JSON.stringify(e)+JSON.stringify(o),[e,o]);(0,c.useEffect)(()=>{let t=Array.isArray(e)?e:[],s=Array.isArray(o)?o:[];if(s.length===0&&t.length===0)return;let{stands:l,unallocated:g}=Te(t,s);j(l),rt(g),Ft(!1);let r=Ut(l);Et.current=Yt(r),O(r),et(t.map(d=>d.id)),nt(!1)},[te]),(0,c.useEffect)(()=>{let t=Tt.current;if(!t)return;let s=new ResizeObserver(l=>{let g=l[0]?.contentRect.width;g&&g>0&&Zt(g)});return s.observe(t),()=>s.disconnect()},[]);let W=f||3,z=p||9,P=I||17,k=(0,c.useMemo)(()=>{let t=new Date;for(t.setHours(0,0,0,0);t.getDay()!==1;)t.setDate(t.getDate()-1);return t},[]),kt=(0,c.useMemo)(()=>{let t=u||"In Progress",s=new Date(k);return s.setDate(s.getDate()+D*7),T.forEach(l=>{let g=l.tests.filter(x=>x.status===t).sort((x,h)=>{let S=x.started_date?new Date(x.started_date).getTime():Date.now(),R=h.started_date?new Date(h.started_date).getTime():Date.now();return S-R}),r=null;for(let x of g){let h=x.started_date?new Date(x.started_date):new Date,S=r&&h<r?new Date(r):h,R=new Date(S.getTime()+x.duration*H);r=J(R,W,z,P)}let d=l.tests.filter(x=>x.status!==t),v=r?new Date(r):(()=>{let x=new Date(Math.max(k.getTime(),Date.now()));return x.setMinutes(0,0,0),x})();for(let x of d){let h=new Date(v.getTime()+x.duration*H);v=J(h,W,z,P)}v>s&&(s=v)}),s.setDate(s.getDate()+7),s},[T,k,D,W,z,P,u]),Y=(0,c.useMemo)(()=>Math.ceil(K(k,kt)/24),[k,kt]),_=Xt/(D*7*24),ht=(0,c.useMemo)(()=>xe(k,Y),[k,Y]),ee=(0,c.useMemo)(()=>ve(k,Y),[k,Y]),Rt=Y*24*_,at=24*_,ne=(0,c.useMemo)(()=>{let t=u||"In Progress",s=new Map;return T.forEach(l=>{let g=[],r=l.tests.filter(h=>h.status===t).sort((h,S)=>{let R=h.started_date?new Date(h.started_date).getTime():Date.now(),w=S.started_date?new Date(S.started_date).getTime():Date.now();return R-w}),d=null;for(let h of r){let S=h.started_date?new Date(h.started_date):new Date,R=d&&S<d?new Date(d):S,w=new Date(R.getTime()+h.duration*H);g.push({...h,start:R,end:w}),d=J(w,W,z,P)}let b=l.tests.filter(h=>h.status!==t),x=d?new Date(d):(()=>{let h=new Date(Math.max(k.getTime(),Date.now()));return h.setMinutes(0,0,0),h})();for(let h of b){let S=new Date(x),R=new Date(S.getTime()+h.duration*H);x=J(R,W,z,P),g.push({...h,start:S,end:R})}s.set(l.id,g)}),s},[T,k,W,z,P,u]),ut=(0,c.useCallback)(t=>{let s=Ut(t),l=Yt(s)!==Et.current;Ft(l),O(s),nt(l),ct()},[O,nt,ct]),pt=(0,c.useCallback)(t=>{let s=C.find(l=>l.id===t);if(s)return s;for(let l of T){let g=l.tests.find(r=>r.id===t);if(g)return g}return null},[C,T]),G=(0,c.useCallback)(()=>{ot(null),st(null),Q(null)},[]),yt=(0,c.useCallback)((t,s)=>{if(!m)return;let l=pt(m);if(!l)return;rt(r=>r.filter(d=>d.id!==m));let g=T.map(r=>{let d=r.tests.filter(b=>b.id!==m);if(r.id===t){let b=[...d];return b.splice(s,0,l),{...r,tests:b}}return{...r,tests:d}});j(g),ut(g),G()},[m,pt,T,ut,G]),bt=(0,c.useCallback)(t=>{if(!m)return;let s=pt(m);if(!s)return;let l=T.map(g=>({...g,tests:g.tests.filter(r=>r.id!==m)}));rt(g=>{let d=[...g.filter(b=>b.id!==m)];return d.splice(t,0,s),d}),j(l),ut(l),G()},[m,pt,T,ut,G]),_t=(0,c.useCallback)((t,s)=>({left:Math.max(0,K(k,t))*_,width:Math.max(s*_,2)}),[k,_]),It=T.reduce((t,s)=>t+s.tests.length,0),re=T.reduce((t,s)=>t+s.tests.reduce((l,g)=>l+g.duration,0),0),xt=String(gt||"{name}"),At=String(Z||""),Wt=String(lt||""),zt=String(tt||"").replace(/\\n/g,`
`),oe=(0,c.useMemo)(()=>{let t=[...C];if(it.trim()){let s=it.toLowerCase().trim();t=t.filter(l=>(l.name||"").toLowerCase().includes(s)||(l.owner||"").toLowerCase().includes(s)||String(l.id).toLowerCase().includes(s))}return U==="az"?t.sort((s,l)=>(s.name||"").localeCompare(l.name||"")):t.sort((s,l)=>(l.priority??50)-(s.priority??50)),t},[C,U,it]),se=72,Pt=84;return i(wt,{children:[n("style",{children:"@keyframes scheduler-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"}),i("div",{style:y.container,children:[a==="saving"&&n("div",{style:{position:"absolute",inset:0,zIndex:2e3,background:"rgba(255,255,255,0.55)",cursor:"wait",pointerEvents:"all"}}),i("div",{style:y.sidebar,children:[i("div",{style:{padding:"20px 16px 12px",borderBottom:"1px solid #E5E7EB"},children:[i("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[i("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n("div",{style:{width:8,height:8,borderRadius:"50%",background:C.length>0?"#F59E0B":"#10B981"}}),n("span",{style:{...y.mono,fontSize:13,fontWeight:700,letterSpacing:"0.08em",textTransform:"uppercase",color:"#4B5563"},children:"Queue"})]}),i("div",{style:{display:"flex",gap:2,background:"#F3F4F6",borderRadius:6,padding:2,border:"1px solid #E5E7EB"},children:[n("button",{onClick:()=>Bt("az"),style:{...y.mono,padding:"3px 8px",fontSize:9,fontWeight:600,borderRadius:4,border:"none",cursor:"pointer",background:U==="az"?"#3B82F6":"transparent",color:U==="az"?"#FFF":"#6B7280"},children:"A\u2192Z"}),n("button",{onClick:()=>Bt("priority"),style:{...y.mono,padding:"3px 8px",fontSize:9,fontWeight:600,borderRadius:4,border:"none",cursor:"pointer",background:U==="priority"?"#3B82F6":"transparent",color:U==="priority"?"#FFF":"#6B7280"},children:"Priority"})]})]}),i("div",{style:{position:"relative",marginTop:6},children:[n("input",{type:"text",value:it,onChange:t=>Ct(t.target.value),placeholder:"Filter by name, owner, ID...",style:{...y.mono,width:"100%",padding:"5px 28px 5px 8px",fontSize:11,border:"1px solid #E5E7EB",borderRadius:6,background:"#F9FAFB",color:"#111827",outline:"none"},onFocus:t=>{t.currentTarget.style.borderColor="#3B82F6",t.currentTarget.style.background="#FFFFFF"},onBlur:t=>{t.currentTarget.style.borderColor="#E5E7EB",t.currentTarget.style.background="#F9FAFB"}}),it&&n("button",{onClick:()=>Ct(""),style:{position:"absolute",right:6,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",fontSize:14,lineHeight:1,padding:0},children:"\xD7"})]})]}),i("div",{style:{flex:1,overflowY:"auto",padding:"8px 10px"},onDragOver:t=>{t.preventDefault(),t.target===t.currentTarget&&Q(C.length)},onDragLeave:t=>{t.currentTarget===t.target&&Q(null)},onDrop:t=>{t.preventDefault(),bt(mt??C.length)},children:[oe.map((t,s)=>{let l=Vt(t,null),g=t.status||B||"Queued",r=!he(At,t);return i("div",{children:[n("div",{onDragOver:d=>{d.preventDefault(),d.stopPropagation(),Q(s)},onDrop:d=>{d.preventDefault(),d.stopPropagation(),bt(s)},style:{height:mt===s&&m&&m!==t.id?6:0,background:"#3B82F6",borderRadius:3,transition:"height 0.12s ease"}}),n(Qt,{testName:L(xt,t),priority:t.priority,status:g,tooltipLines:L(zt,t),children:i("div",{draggable:!0,onDragStart:d=>{d.dataTransfer.effectAllowed="move",ot(t.id)},onDragEnd:G,onDragOver:d=>{d.preventDefault(),d.stopPropagation();let b=d.currentTarget.getBoundingClientRect();Q(d.clientY<b.top+b.height/2?s:s+1)},onMouseEnter:d=>{let b=d.currentTarget;b.style.transform="translateY(-2px)",b.style.boxShadow="0 4px 12px rgba(0,0,0,0.15)",b.style.border=`2px solid ${N(l)}`},onMouseLeave:d=>{let b=d.currentTarget;b.style.transform="translateY(0)",b.style.boxShadow="0 1px 3px rgba(0,0,0,0.06)",b.style.border="1px solid #E5E7EB"},style:{display:"flex",marginBottom:6,background:m===t.id?"#F3F4F6":"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:8,cursor:"grab",opacity:m===t.id?.35:1,overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.06)",transition:"transform 0.15s ease, box-shadow 0.15s ease, border 0.15s ease"},children:[n("div",{style:{width:5,minWidth:5,background:N(l),borderRadius:"8px 0 0 8px",flexShrink:0}}),i("div",{style:{flex:1,padding:"8px 12px",minWidth:0},children:[i("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[i("span",{style:{...y.mono,fontSize:11,fontWeight:700,color:$(t.priority),background:`${$(t.priority)}18`,border:`1px solid ${$(t.priority)}44`,borderRadius:99,padding:"2px 8px"},children:["P",t.priority]}),n("span",{style:{...y.mono,fontSize:10,fontWeight:700,letterSpacing:"0.04em",color:St(g),textTransform:"uppercase",background:`${X(g)}22`,border:`1px solid ${X(g)}55`,borderRadius:99,padding:"2px 7px"},children:g})]}),n("div",{style:{fontSize:14,fontWeight:600,color:"#111827",marginBottom:2,lineHeight:1.3},children:L(xt,t)}),r&&n("div",{style:{...y.mono,fontSize:11,color:"#6B7280",marginBottom:4,fontWeight:400},children:L(At,t)}),n("div",{style:{...y.mono,display:"flex",gap:8,fontSize:11,color:"#4B5563",flexWrap:"wrap"},children:L(Wt,t).split("\xB7").map((d,b,v)=>i(c.default.Fragment,{children:[n("span",{children:d.trim()}),b<v.length-1&&n("span",{children:"\xB7"})]},b))})]})]})})]},t.id)}),n("div",{onDragOver:t=>{t.preventDefault(),Q(C.length)},onDrop:t=>{t.preventDefault(),bt(C.length)},style:{height:mt===C.length&&m?6:0,background:"#3B82F6",borderRadius:3,transition:"height 0.12s ease",margin:"0 4px"}}),C.length===0&&n("div",{style:{textAlign:"center",padding:"32px 16px",color:"#6B7280",fontSize:12,border:m?"2px dashed #3B82F6":"2px dashed #D1D5DB",borderRadius:8,marginTop:8,background:m?"#EFF6FF":"transparent"},children:m?"Drop to return to queue":"All tests allocated"})]}),n(Ee,{}),n("div",{style:{padding:"12px 16px",borderTop:"1px solid #E5E7EB",background:"#F9FAFB"},children:i("div",{style:{...y.mono,display:"flex",justifyContent:"space-between",fontSize:10,color:"#6B7280"},children:[i("span",{children:[It,"/",It+C.length," allocated"]}),i("span",{children:["Queue: ",C.length]}),i("span",{children:[re,"h"]})]})})]}),i("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[i("div",{style:{padding:"12px 24px",borderBottom:"1px solid #E5E7EB",background:"#FFFFFF",display:"flex",alignItems:"center",justifyContent:"space-between",gap:16,flexWrap:"wrap"},children:[i("div",{style:{minWidth:0},children:[n("h1",{style:{fontSize:18,fontWeight:700,color:"#111827",letterSpacing:"-0.02em"},children:"Test Stand Scheduler"}),i("p",{style:{...y.mono,fontSize:11,color:"#6B7280",marginTop:2},children:["Continuous testing \xB7 ",W,"h changeover (",z,":00\u2013",P,":00 Mon\u2013Fri) \xB7 Auto-save"]})]}),i("div",{style:{display:"flex",alignItems:"center",gap:12},children:[a==="saving"&&i("div",{style:{...y.mono,display:"flex",alignItems:"center",gap:6,fontSize:11,fontWeight:600,color:"#3B82F6"},children:[n("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",style:{animation:"scheduler-spin 0.8s linear infinite"},children:n("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),"Saving\u2026"]}),a==="error"&&i("div",{style:{...y.mono,display:"flex",alignItems:"center",gap:6,fontSize:11,fontWeight:600,color:"#DC2626"},children:[n("div",{style:{width:8,height:8,borderRadius:"50%",background:"#DC2626"}}),"Save failed"]}),a==="idle"&&Jt&&n("div",{style:{...y.mono,fontSize:11,fontWeight:600,color:"#9CA3AF"},children:"Unsaved"}),n("div",{style:{display:"flex",gap:4,background:"#F3F4F6",borderRadius:8,padding:3,border:"1px solid #E5E7EB"},children:[2,4,8,12,24].map(t=>i("button",{onClick:()=>V(t),style:{...y.mono,padding:"6px 12px",fontSize:11,fontWeight:600,borderRadius:6,border:"none",cursor:"pointer",background:D===t?"#3B82F6":"transparent",color:D===t?"#FFF":"#4B5563"},children:[t,"W"]},t))})]})]}),a==="error"&&i("div",{style:{background:"#FEF2F2",borderBottom:"1px solid #FCA5A5",padding:"8px 24px",display:"flex",alignItems:"center",gap:8},children:[i("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"#DC2626",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[n("circle",{cx:"12",cy:"12",r:"10"}),n("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),n("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),n("span",{style:{...y.mono,fontSize:11,fontWeight:600,color:"#DC2626"},children:"Save failed \u2014 your view may differ from the database. Re-trigger the data query to resync."})]}),n("div",{ref:Kt,style:{flex:1,overflow:"auto",background:"#F9FAFB"},children:i("div",{ref:Tt,style:{minWidth:Rt,padding:"0 12px 24px",position:"relative"},children:[i("div",{style:{position:"sticky",top:0,zIndex:20,background:"#F9FAFB",borderBottom:"1px solid #E5E7EB"},children:[n("div",{style:{display:"flex",height:28,position:"relative",borderBottom:"1px solid #E5E7EB"},children:ee.map((t,s)=>n("div",{style:{...y.mono,position:"absolute",left:K(k,t)*_,width:7*24*_,height:28,display:"flex",alignItems:"center",paddingLeft:8,fontSize:10,fontWeight:600,color:"#4B5563",borderLeft:s>0?"1px solid #E5E7EB":"none"},children:De(t)},s))}),n("div",{style:{display:"flex",height:24},children:ht.map((t,s)=>{let l=t.toDateString()===new Date().toDateString(),g=t.getDay()===0||t.getDay()===6;return n("div",{style:{...y.mono,width:at,minWidth:at,fontSize:9,textAlign:"center",color:l?"#2563EB":"#6B7280",fontWeight:l?700:400,lineHeight:"24px",borderLeft:"1px solid #E5E7EB",background:l?"#EFF6FF":g?"#F3F4F6":"transparent"},children:D<=8||t.getDay()===1?t.getDate():""},s)})})]}),T.map(t=>{let s=ne.get(t.id)??[],l=ft,g=l&&l.standId===t.id;return i("div",{style:{marginTop:16},children:[i("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6,paddingLeft:2},children:[n("div",{style:{width:6,height:6,borderRadius:2,background:t.tests.length>0?"#3B82F6":"#9CA3AF"}}),n("span",{style:{...y.mono,fontSize:11,fontWeight:600,color:"#374151"},children:t.name}),i("span",{style:{...y.mono,fontSize:10,color:"#6B7280"},children:[t.tests.length," test",t.tests.length!==1?"s":"",t.tests.length>0&&` \xB7 ${t.tests.reduce((r,d)=>r+d.duration,0)}h`]})]}),i("div",{onDragOver:r=>{r.preventDefault(),st({standId:t.id,index:t.tests.length})},onDragLeave:r=>{r.currentTarget.contains(r.relatedTarget)||st(null)},onDrop:r=>{r.preventDefault(),yt(t.id,l?.standId===t.id?l.index:t.tests.length)},style:{position:"relative",height:Pt,background:g||m&&t.tests.length===0?"#EFF6FF":"#F3F4F6",border:`1px solid ${g||m&&t.tests.length===0?"#BFDBFE":"#E5E7EB"}`,borderRadius:8,width:Rt,transition:"background 0.15s ease, border-color 0.15s ease"},children:[ht.map((r,d)=>r.getDay()!==0&&r.getDay()!==6?null:n("div",{style:{position:"absolute",left:d*at,top:0,bottom:0,width:at,background:"#E5E7EB",pointerEvents:"none"}},`we-${d}`)),ht.map((r,d)=>n("div",{style:{position:"absolute",left:d*at,top:0,bottom:0,width:1,background:"#E5E7EB"}},d)),(()=>{let r=K(k,new Date);return r<0||r>Y*24?null:n("div",{style:{position:"absolute",left:r*_,top:0,bottom:0,width:2,background:"#EF4444",zIndex:10},children:n("div",{style:{position:"absolute",top:-3,left:-3,width:8,height:8,borderRadius:"50%",background:"#EF4444"}})})})(),s.map((r,d)=>{let{left:b,width:v}=_t(r.start,r.duration),x=J(r.end,W,z,P),h=K(r.end,x)*_,S=Vt(r,r.start),R=u||"In Progress",w=r.status===R,vt=L(xt,r),Mt=L(Wt,r),ie=Mt.trim()!==""&&v>120;return i("div",{style:{position:"absolute",left:b,top:0,width:v+h,height:"100%"},children:[m&&m!==r.id&&i(dt,{children:[n("div",{onDragOver:E=>{E.preventDefault(),E.stopPropagation(),st({standId:t.id,index:d})},onDrop:E=>{E.preventDefault(),E.stopPropagation(),yt(t.id,d)},style:{position:"absolute",left:-6,top:0,width:"50%",height:"100%",zIndex:20,minWidth:20}}),n("div",{onDragOver:E=>{E.preventDefault(),E.stopPropagation(),st({standId:t.id,index:d+1})},onDrop:E=>{E.preventDefault(),E.stopPropagation(),yt(t.id,d+1)},style:{position:"absolute",right:-6,top:0,width:"50%",height:"100%",zIndex:20,minWidth:20}})]}),g&&l.index===d&&n("div",{style:{position:"absolute",left:-4,top:0,bottom:0},children:n(jt,{})}),n(Qt,{testName:vt,priority:r.priority,status:w?r.status:S,tooltipLines:L(zt,r),scheduled:r,wrapperStyle:{position:"absolute",left:0,top:0,width:v,height:"100%"},children:i("div",{draggable:!0,onDragStart:E=>{E.dataTransfer.effectAllowed="move",E.dataTransfer.setData("text/plain",String(r.id)),ot(r.id)},onDragEnd:G,onMouseEnter:E=>{if(!m){let M=E.currentTarget;M.style.transform="translateY(-2px)",M.style.boxShadow=w?"0 4px 12px rgba(245,158,11,0.35)":"0 4px 12px rgba(0,0,0,0.15)",M.style.border=w?"2px solid #D97706":`2px solid ${N(S)}`,M.style.zIndex="25"}},onMouseLeave:E=>{let M=E.currentTarget;M.style.transform="translateY(0)",M.style.boxShadow=w?"0 2px 8px rgba(245,158,11,0.25)":"0 1px 3px rgba(0,0,0,0.06)",M.style.border=w?"2px solid #F59E0B":"1px solid #E5E7EB",M.style.zIndex="15"},style:{position:"absolute",left:0,top:6,width:v,height:se,background:w?"repeating-linear-gradient(-45deg, #FEF9C3 0px, #FEF9C3 8px, #FDE68A 8px, #FDE68A 16px)":"#FFFFFF",borderRadius:8,cursor:"grab",display:"flex",flexDirection:"row",overflow:"hidden",opacity:m===r.id?.25:1,zIndex:15,border:w?"2px solid #F59E0B":"1px solid #E5E7EB",boxShadow:w?"0 2px 8px rgba(245,158,11,0.25)":"0 1px 3px rgba(0,0,0,0.06)",transition:"transform 0.15s ease, box-shadow 0.15s ease, border 0.15s ease"},children:[n("div",{style:{width:5,minWidth:5,background:w?X(R):N(S),flexShrink:0}}),i("div",{style:{flex:1,display:"flex",flexDirection:"column",padding:"4px 8px",minWidth:0,justifyContent:"center"},children:[v>70&&i("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2},children:[i("span",{style:{...y.mono,fontSize:v>120?10:8,fontWeight:700,color:$(r.priority),background:`${$(r.priority)}18`,border:`1px solid ${$(r.priority)}44`,borderRadius:99,padding:"1px 5px"},children:["P",r.priority]}),v>100&&n("span",{style:{...y.mono,fontSize:8,fontWeight:700,letterSpacing:"0.04em",color:w?St(r.status):Gt(S),textTransform:"uppercase",background:w?`${X(r.status)}22`:`${N(S)}22`,border:`1px solid ${w?X(r.status):N(S)}55`,borderRadius:99,padding:"1px 5px",whiteSpace:"nowrap"},children:w?r.status:S})]}),n("span",{style:{fontSize:v>120?12:v>80?11:10,fontWeight:600,color:"#111827",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",lineHeight:1.2},children:w&&v>60?`\u25B6 ${vt}`:vt}),ie&&n("span",{style:{...y.mono,fontSize:9,fontWeight:400,color:"#4B5563",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",marginTop:2},children:Mt})]})]})}),d<s.length&&h>0&&n("div",{style:{position:"absolute",left:v,top:Pt/2-8,width:h,height:16,display:"flex",alignItems:"center",justifyContent:"center"},children:n("div",{style:{height:1,width:"80%",background:"repeating-linear-gradient(90deg, #9CA3AF 0, #9CA3AF 4px, transparent 4px, transparent 8px)"}})})]},r.id)}),g&&l.index===t.tests.length&&s.length>0&&(()=>{let r=s[s.length-1],{left:d,width:b}=_t(r.start,r.duration),v=J(r.end,W,z,P),x=K(r.end,v)*_;return n("div",{style:{position:"absolute",left:d+b+x+8,top:0,bottom:0},children:n(jt,{})})})(),t.tests.length===0&&n("div",{style:{...y.mono,position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,color:m?"#3B82F6":"#9CA3AF",fontWeight:m?600:400},children:m?"Drop here to schedule":"Drop tests here to schedule"})]})]},t.id)}),T.length===0&&n("div",{style:{...y.mono,textAlign:"center",padding:"48px 24px",color:"#6B7280",fontSize:12},children:"No test stands loaded. Bind the testStands property to your getTestStands query."})]})})]})]})]})};export{ze as TestStandScheduler};
