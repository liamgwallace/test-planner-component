var Xt=Object.create;var Ft=Object.defineProperty;var Zt=Object.getOwnPropertyDescriptor;var en=Object.getOwnPropertyNames;var tn=Object.getPrototypeOf,nn=Object.prototype.hasOwnProperty;var on=(t,o)=>()=>(o||t((o={exports:{}}).exports,o),o.exports);var rn=(t,o,r,d)=>{if(o&&typeof o=="object"||typeof o=="function")for(let c of en(o))!nn.call(t,c)&&c!==r&&Ft(t,c,{get:()=>o[c],enumerable:!(d=Zt(o,c))||d.enumerable});return t};var sn=(t,o,r)=>(r=t!=null?Xt(tn(t)):{},rn(o||!t||!t.__esModule?Ft(r,"default",{value:t,enumerable:!0}):r,t));var Et=on((wn,wt)=>{wt.exports=window.ccc_support_React});var s=sn(Et());var{Retool:m}=window.ccc_support_RetoolCustomComponenCollections;var{Fragment:xe,jsxs:u,jsx:n,default:Bn}=window.ccc_support_ReactJSXRuntime;var an=t=>{if(t==null||t===""||t==="nan")return"";let o=String(t);if(/^\d{4}-\d{2}-\d{2}/.test(o)){let r=new Date(o);if(!isNaN(r.getTime()))return r.toLocaleDateString("en-GB",{day:"2-digit",month:"short"})}return o},X=(t,o)=>t?(typeof t=="string"?t:String(t)).replace(/\{(\w+)\}/g,(d,c)=>an(o[c])):"",ln=(t,o)=>{let r=typeof t=="string"?t:String(t||""),d=X(r,o),c=r.replace(/\{(\w+)\}/g,"");return d.trim()===c.trim()||d.trim()===""},Z=36e5,Me=t=>{if(!t)return null;let r=t.split("T")[0].split("-").map(Number);if(r.length!==3||r.some(isNaN))return null;let d=new Date(r[0],r[1]-1,r[2],0,0,0,0);return isNaN(d.getTime())?null:d},dn=t=>{let o=new Date(t);return o.setHours(0,0,0,0),o},Bt=t=>t.getDay()!==0&&t.getDay()!==6,Ke=(t,o)=>{let r=new Date(t);for(r.setHours(o,0,0,0);r.getDay()===0||r.getDay()===6;)r.setDate(r.getDate()+1);return r},de=(t,o,r,d)=>{let c=new Date(t);!Bt(c)||c.getHours()>=d?c=Ke(new Date(c.getTime()+Z*12),r):c.getHours()<r&&c.setHours(r,0,0,0);let p=o,f=new Date(c);for(;p>0;){if(!Bt(f)){f=Ke(new Date(f.getTime()+Z*12),r);continue}let B=d-f.getHours(),k=Math.min(p,B);f.setTime(f.getTime()+k*Z),p-=k,p>0&&(f=Ke(new Date(f.getTime()+Z*12),r))}return f},cn=t=>{if(!Array.isArray(t))return[];let o=[];for(let r of t){if(!r||typeof r!="object")continue;let d=new Date(r.start),c=new Date(r.end);isNaN(d.getTime())||isNaN(c.getTime())||c<=d||o.push({start:d,end:c,notes:r.notes??void 0})}return o},un=(t,o)=>{let r=new Date(t),d=!0;for(;d;){d=!1;for(let c of o)r>=c.start&&r<c.end&&(r=new Date(c.end),d=!0)}return r},pn=(t,o,r)=>{let d=new Date(t),c=!0;for(;c;){c=!1;let p=new Date(d.getTime()+o*Z);for(let f of r)if(d<f.end&&p>f.start){d=new Date(f.end),c=!0;break}}return d},gn=(t,o)=>{let r=[],d=new Date(t);for(let c=0;c<o;c++)r.push(new Date(d)),d.setDate(d.getDate()+1);return r},fn=(t,o)=>{let r=[],d=new Date(t);for(;d.getDay()!==1;)d.setDate(d.getDate()-1);let c=new Date(t);for(c.setDate(c.getDate()+o);d<c;)r.push(new Date(d)),d.setDate(d.getDate()+7);return r},H=(t,o)=>(o.getTime()-t.getTime())/Z,hn=t=>`W/C ${t.toLocaleDateString("en-GB",{day:"2-digit",month:"short"})}`,mn=t=>{if(!t||t==="nan")return"In Progress";let o=t.toLowerCase().trim();return o==="ready"?"Ready":o==="parts not assigned"?"Parts Not Assigned":"In Progress"},yn=(t,o=null)=>{let r=mn(t.part_status);if(r==="Ready")return"Ready";if(r==="Parts Not Assigned")return"Parts Not Assigned";if(o&&t.part_ready_date){let d=Me(t.part_ready_date),c=dn(o);if(d&&c)return d.getTime()>c.getTime()?"Delayed":"On Time"}return"In Progress"},Se=t=>t.status==="Running",Xe={Running:"#9333EA",Ready:"#22C55E","On Time":"#E5A00D",Delayed:"#EF4444","Parts Not Assigned":"#9CA3AF","In Progress":"#E5A00D"},Ct={Running:"#7E22CE",Ready:"#16A34A","On Time":"#B45309",Delayed:"#DC2626","Parts Not Assigned":"#6B7280","In Progress":"#B45309"},ce=t=>Xe[t]||Xe["In Progress"],ze=t=>Ct[t]||Ct["In Progress"],We=(t,o=null)=>Se(t)?"Running":yn(t,o),Ze=t=>{let r=Math.max(0,Math.min(100,typeof t=="number"?t:50));return r<=30?"#6B7280":r<=60?"#F59E0B":r<=80?"#EA580C":"#DC2626"};var v={container:{display:"flex",height:"100%",background:"#F9FAFB",overflow:"hidden",fontFamily:"'DM Sans', sans-serif",position:"relative"},sidebar:{width:320,minWidth:320,background:"#FFFFFF",borderRight:"1px solid #E5E7EB",display:"flex",flexDirection:"column"},mono:{fontFamily:"'JetBrains Mono', monospace"}},Tt=()=>u("div",{style:{position:"absolute",top:2,bottom:2,width:3,background:"#3B82F6",borderRadius:2,zIndex:30,boxShadow:"0 0 12px #3B82F6, 0 0 4px #3B82F6",pointerEvents:"none"},children:[n("div",{style:{position:"absolute",top:-4,left:-4,width:11,height:11,borderRadius:"50%",background:"#3B82F6"}}),n("div",{style:{position:"absolute",bottom:-4,left:-4,width:11,height:11,borderRadius:"50%",background:"#3B82F6"}})]}),vn=()=>u("div",{style:{padding:"10px 16px",borderTop:"1px solid #E5E7EB",background:"#F9FAFB"},children:[n("h3",{style:{...v.mono,fontSize:11,fontWeight:700,letterSpacing:"0.08em",textTransform:"uppercase",color:"#4B5563",marginBottom:6},children:"Status Key"}),n("div",{style:{display:"flex",flexWrap:"wrap",gap:"4px 0"},children:["Running","Ready","On Time","Delayed","Parts Not Assigned"].map(t=>u("div",{style:{display:"flex",alignItems:"center",gap:6,width:"50%",minWidth:0},children:[n("div",{style:{width:4,height:14,background:Xe[t],borderRadius:2,flexShrink:0}}),n("span",{style:{...v.mono,fontSize:9,color:ze(t),fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.toUpperCase()})]},t))})]}),bn=({test:t,draggedTestId:o,status:r,mainText:d,subText:c,infoRow:p,showSub:f,onDragStart:B,onDragEnd:k,onDragOver:_,onContextMenu:O})=>{let[R,x]=s.default.useState(!1);return u("div",{draggable:!0,onDragStart:W=>{W.dataTransfer.effectAllowed="move",B()},onDragEnd:k,onDragOver:_,onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),onContextMenu:O,style:{display:"flex",marginBottom:6,background:o===t.id?"#F3F4F6":"#FFFFFF",border:R?`2px solid ${ce(r)}`:"1px solid #E5E7EB",borderRadius:8,cursor:"grab",opacity:o===t.id?.35:1,overflow:"hidden",boxShadow:R?"0 4px 12px rgba(0,0,0,0.15)":"0 1px 3px rgba(0,0,0,0.06)",transform:R?"translateY(-2px)":"translateY(0)",transition:"transform 0.15s ease, box-shadow 0.15s ease, border 0.15s ease"},children:[n("div",{style:{width:5,minWidth:5,background:ce(r),borderRadius:"8px 0 0 8px",flexShrink:0}}),u("div",{style:{flex:1,padding:"8px 12px",minWidth:0},children:[u("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:4},children:[u("span",{style:{...v.mono,fontSize:13,fontWeight:700,color:Ze(t.priority)},children:["P",t.priority]}),n("span",{style:{...v.mono,fontSize:11,fontWeight:700,letterSpacing:"0.05em",color:ze(r),textTransform:"uppercase"},children:r.toUpperCase()})]}),n("div",{style:{fontSize:14,fontWeight:600,color:"#111827",marginBottom:2,lineHeight:1.3},children:d}),f&&n("div",{style:{...v.mono,fontSize:11,color:"#6B7280",marginBottom:4,fontWeight:400},children:c}),n("div",{style:{...v.mono,display:"flex",gap:8,fontSize:11,color:"#4B5563",flexWrap:"wrap"},children:p.split("\xB7").map((W,q,ee)=>u(s.default.Fragment,{children:[n("span",{children:W.trim()}),q<ee.length-1&&n("span",{children:"\xB7"})]},q))})]})]})},xn=({test:t,isTestRunning:o,draggedTestId:r,width:d,BAR_HEIGHT:c,displayStatus:p,resolvedMain:f,resolvedInfo:B,showInfoOnBar:k,onDragStart:_,onDragEnd:O,onContextMenu:R})=>{let[x,W]=s.default.useState(!1);return u("div",{draggable:!0,onDragStart:_,onDragEnd:O,onMouseEnter:()=>{r||W(!0)},onMouseLeave:()=>W(!1),onContextMenu:R,style:{position:"absolute",left:0,top:6,width:d,height:c,background:o?"#F3E8FF":"#FFFFFF",borderRadius:8,cursor:"grab",display:"flex",flexDirection:"row",overflow:"hidden",opacity:r===t.id?.25:1,zIndex:x?25:15,border:x?`2px solid ${ce(p)}`:o?"1px solid #C4B5FD":"1px solid #E5E7EB",boxShadow:x?"0 4px 12px rgba(0,0,0,0.15)":o?"0 1px 3px rgba(147,51,234,0.15)":"0 1px 3px rgba(0,0,0,0.06)",transform:x?"translateY(-2px)":"translateY(0)",transition:"transform 0.15s ease, box-shadow 0.15s ease, border 0.15s ease"},children:[n("div",{style:{width:5,minWidth:5,background:ce(p),flexShrink:0}}),u("div",{style:{flex:1,display:"flex",flexDirection:"column",padding:"4px 8px",minWidth:0,justifyContent:"center"},children:[d>70&&u("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:2},children:[n("span",{style:{...v.mono,fontSize:d>120?11:9,fontWeight:700,color:o?"#7E22CE":Ze(t.priority)},children:o?"\u25B6 RUNNING":`P${t.priority}`}),d>100&&!o&&n("span",{style:{...v.mono,fontSize:9,fontWeight:700,letterSpacing:"0.05em",color:ze(p),textTransform:"uppercase"},children:p.toUpperCase()})]}),n("span",{style:{fontSize:d>120?12:d>80?11:10,fontWeight:600,color:o?"#3B0764":"#111827",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",lineHeight:1.2},children:f}),k&&n("span",{style:{...v.mono,fontSize:9,fontWeight:400,color:o?"#7E22CE":"#4B5563",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",marginTop:2},children:B})]})]})},Ie=({label:t,icon:o,onClick:r})=>{let[d,c]=s.default.useState(!1);return u("div",{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),onClick:r,style:{padding:"8px 14px",fontSize:13,fontWeight:500,color:"#111827",cursor:"pointer",background:d?"#F3F4F6":"transparent",display:"flex",alignItems:"center",gap:8,userSelect:"none"},children:[o&&n("span",{style:{fontSize:14,width:18,textAlign:"center",color:"#6B7280"},children:o}),t]})},Sn=({menu:t,statusOptionsList:o,priorityInputValue:r,onClose:d,onModeChange:c,onPriorityInputChange:p,onConfirmPriority:f,onPickStatus:B,onEditTest:k,panelRef:_})=>{let O=Math.min(t.x,window.innerWidth-210),R=Math.min(t.y,window.innerHeight-150);return u("div",{ref:_,onContextMenu:x=>x.preventDefault(),style:{position:"fixed",left:O,top:R,zIndex:3e3,background:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:10,boxShadow:"0 4px 16px rgba(0,0,0,0.12), 0 1px 4px rgba(0,0,0,0.06)",minWidth:200,overflow:"hidden"},children:[n("div",{style:{padding:"10px 14px 8px",borderBottom:"1px solid #E5E7EB",background:"#F9FAFB"},children:n("div",{style:{fontSize:13,fontWeight:700,color:"#111827",lineHeight:1.3,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:180},children:t.test.name})}),t.mode==="root"&&u("div",{style:{padding:"4px 0"},children:[n(Ie,{label:"Change Priority",icon:"\u2B06",onClick:()=>c("priority")}),n(Ie,{label:"Change Status",icon:"\u25C9",onClick:()=>c("status")}),n(Ie,{label:"Edit Test",icon:"\u270E",onClick:k})]}),t.mode==="priority"&&u("div",{style:{padding:"10px 14px"},children:[n("div",{style:{fontSize:12,color:"#6B7280",marginBottom:8},children:"Enter priority (0\u2013100):"}),n("input",{type:"number",min:0,max:100,autoFocus:!0,value:r,onChange:x=>p(x.target.value),onKeyDown:x=>{x.key==="Enter"&&f(),x.key==="Escape"&&d()},style:{width:"100%",boxSizing:"border-box",padding:"6px 8px",fontSize:13,borderRadius:6,border:"1px solid #D1D5DB",outline:"none",marginBottom:8}}),u("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n("button",{onClick:f,style:{flex:1,padding:"6px 0",fontSize:12,fontWeight:600,background:"#3B82F6",color:"#FFFFFF",border:"none",borderRadius:6,cursor:"pointer"},children:"Confirm"}),n("span",{onClick:d,style:{fontSize:12,color:"#6B7280",cursor:"pointer",textDecoration:"underline"},children:"Cancel"})]})]}),t.mode==="status"&&n("div",{style:{padding:"4px 0"},children:o.map(x=>n(Ie,{label:x==="NULL"?"Clear Status (NULL)":x,onClick:()=>B(x)},x))})]})},Dn=({isError:t,onRetry:o,onDiscard:r})=>n("div",{style:{position:"absolute",inset:0,zIndex:2e3,background:"rgba(249,250,251,0.82)",display:"flex",alignItems:"center",justifyContent:"center"},children:t?u("div",{style:{background:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:12,boxShadow:"0 4px 20px rgba(0,0,0,0.12)",padding:"24px 28px",display:"flex",flexDirection:"column",alignItems:"center",gap:12,maxWidth:300},children:[n("div",{style:{width:40,height:40,borderRadius:"50%",background:"#FEF2F2",border:"1px solid #FECACA",display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,color:"#EF4444",fontWeight:700},children:"!"}),n("div",{style:{fontSize:15,fontWeight:700,color:"#111827"},children:"Save failed"}),n("div",{style:{fontSize:12,color:"#6B7280",textAlign:"center",lineHeight:1.5},children:"The allocation could not be saved. You can retry or discard your changes."}),u("div",{style:{display:"flex",gap:8,marginTop:4},children:[n("button",{onClick:r,style:{padding:"7px 16px",fontSize:12,fontWeight:600,borderRadius:6,border:"1px solid #D1D5DB",cursor:"pointer",background:"#FFFFFF",color:"#374151"},children:"Discard"}),n("button",{onClick:o,style:{padding:"7px 16px",fontSize:12,fontWeight:600,borderRadius:6,border:"none",cursor:"pointer",background:"#3B82F6",color:"#FFFFFF",boxShadow:"0 1px 3px rgba(59,130,246,0.3)"},children:"Retry"})]})]}):u("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[n("div",{style:{width:32,height:32,borderRadius:"50%",border:"3px solid #E5E7EB",borderTopColor:"#3B82F6",animation:"ccl-spin 0.7s linear infinite"}}),n("span",{style:{fontSize:13,fontWeight:600,color:"#374151"},children:"Saving\u2026"})]})}),kt=({testName:t,priority:o,status:r,tooltipLines:d,scheduled:c,wrapperStyle:p,children:f})=>{let[B,k]=s.default.useState(!1),[_,O]=s.default.useState({x:0,y:0,bottom:0}),[R,x]=s.default.useState(!1),W=(0,s.useRef)(null),q=(0,s.useRef)(null),ee=(0,s.useRef)(null),Ne=(0,s.useCallback)(()=>{if(q.current){let C=q.current.getBoundingClientRect();O({x:C.left+C.width/2,y:C.top,bottom:C.bottom})}W.current=window.setTimeout(()=>k(!0),400)},[]),ue=(0,s.useCallback)(()=>{W.current&&clearTimeout(W.current),k(!1),x(!1)},[]);s.default.useLayoutEffect(()=>{B&&ee.current&&ee.current.getBoundingClientRect().top<0&&x(!0)},[B,_]);let te=d.split(`
`).filter(C=>{let G=C.split(":");return G.length<2?C.trim()!=="":G.slice(1).join(":").trim()!==""}),De=u("div",{style:{background:"#FFFFFF",border:"1px solid #E5E7EB",borderRadius:10,boxShadow:"0 4px 16px rgba(0,0,0,0.12), 0 1px 4px rgba(0,0,0,0.06)",padding:"12px 16px",maxWidth:300,minWidth:180},children:[n("div",{style:{fontSize:13,fontWeight:700,color:"#111827",marginBottom:6,lineHeight:1.3},children:t}),u("div",{style:{display:"flex",gap:10,alignItems:"center",marginBottom:8},children:[u("span",{style:{fontSize:13,fontWeight:700,color:Ze(o)},children:["P",o]}),n("span",{style:{fontSize:11,fontWeight:700,color:ze(r),textTransform:"uppercase",letterSpacing:"0.05em",padding:"1px 6px",background:`${ce(r)}18`,borderRadius:4,border:`1px solid ${ce(r)}40`},children:r})]}),n("div",{style:{height:1,background:"#E5E7EB",margin:"0 -4px 8px"}}),te.map((C,G)=>{let pe=C.indexOf(":");if(pe===-1)return n("div",{style:{fontSize:11,color:"#374151",marginBottom:3,lineHeight:1.4},children:C},G);let Fe=C.slice(0,pe).trim(),we=C.slice(pe+1).trim();return u("div",{style:{display:"flex",gap:6,fontSize:11,marginBottom:3,lineHeight:1.4},children:[u("span",{style:{color:"#6B7280",fontWeight:500,flexShrink:0},children:[Fe,":"]}),n("span",{style:{color:"#111827",fontWeight:400},children:we})]},G)}),c&&u(xe,{children:[n("div",{style:{height:1,background:"#E5E7EB",margin:"6px -4px 6px"}}),u("div",{style:{display:"flex",gap:6,fontSize:11,marginBottom:2},children:[n("span",{style:{color:"#6B7280",fontWeight:500},children:"Starts:"}),n("span",{style:{color:"#111827"},children:c.start.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})})]}),u("div",{style:{display:"flex",gap:6,fontSize:11},children:[n("span",{style:{color:"#6B7280",fontWeight:500},children:"Ends:"}),n("span",{style:{color:"#111827"},children:c.end.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})})]})]})]}),ne=n("div",{style:{width:10,height:10,background:"#FFFFFF",border:"1px solid #E5E7EB",borderTop:"none",borderLeft:"none",transform:"rotate(45deg)",margin:"-6px auto 0"}}),Y=n("div",{style:{width:10,height:10,background:"#FFFFFF",border:"1px solid #E5E7EB",borderBottom:"none",borderRight:"none",transform:"rotate(45deg)",margin:"0 auto -6px"}});return u("div",{ref:q,onMouseEnter:Ne,onMouseLeave:ue,style:p||{position:"relative"},children:[f,B&&n("div",{ref:ee,style:{position:"fixed",left:_.x,top:R?_.bottom+8:_.y-8,transform:R?"translate(-50%, 0)":"translate(-50%, -100%)",zIndex:1e3,pointerEvents:"none"},children:R?u(xe,{children:[Y,De]}):u(xe,{children:[De,ne]})})]})},Pe=t=>{let o=[];return t.forEach(r=>{r.tests.forEach((d,c)=>{o.push({test_id:d.id,test_stand_id:r.id,priority_order:c+1})})}),o},Je=t=>JSON.stringify(t.map(o=>`${o.test_id}:${o.test_stand_id}:${o.priority_order}`).sort()),Rt=(t,o,r)=>{let d=new Map;o.forEach(p=>d.set(p.id,{id:p.id,name:p.name,tests:[],changeover_hours:p.changeover_hours??r,nonWorkingBlocks:cn(p.non_working)}));let c=[];return t.forEach(p=>{let f={id:p.id,name:p.name||"",duration:p.duration||72,owner:p.owner||"",priority:p.priority??50,notes:p.notes||"",status:p.status||"",test_stand_id:p.test_stand_id,priority_order:p.priority_order,allocation_id:p.allocation_id,assigned_parts:p.assigned_parts||null,part_ready_date:p.part_ready_date||null,part_status:p.part_status||"",test_started_date:p.test_started_date||null,...p};f.test_stand_id!=null&&d.has(f.test_stand_id)?d.get(f.test_stand_id).tests.push(f):c.push(f)}),d.forEach(p=>{p.tests.sort((f,B)=>(f.priority_order||999)-(B.priority_order||999))}),{stands:o.map(p=>d.get(p.id)),unallocated:c}},Rn=()=>{let[t]=m.useStateArray({name:"tests",initialValue:[],inspector:"text",label:"Tests Data",description:"Array of test objects from getSchedulerData query"}),[o]=m.useStateArray({name:"testStands",initialValue:[],inspector:"text",label:"Test Stands Data",description:"Array of test stand objects from getTestStands query"}),[r]=m.useStateEnumeration({name:"saveMode",initialValue:"batch",enumDefinition:["batch","live"],inspector:"segmented",label:"Save Mode",description:"batch = save button, live = emit on every change"}),[d]=m.useStateBoolean({name:"isSaving",initialValue:!1,inspector:"checkbox",label:"Is Saving",description:"Bind to: {{ saveAllocations.isFetching }}"}),[c]=m.useStateBoolean({name:"hasSaveError",initialValue:!1,inspector:"checkbox",label:"Has Save Error",description:"Bind to: {{ !!saveAllocations.error }}"}),[p]=m.useStateString({name:"savedAt",initialValue:"",inspector:"text",label:"Saved At",description:"Bind to: {{ saveAllocations.lastRunAt }}"}),[f]=m.useStateBoolean({name:"isSavingDates",initialValue:!1,inspector:"checkbox",label:"Is Saving Planned Dates",description:"Bind to: {{ savePlannedDates.isFetching }}"}),[B]=m.useStateBoolean({name:"hasSaveDatesError",initialValue:!1,inspector:"checkbox",label:"Has Save Dates Error",description:"Bind to: {{ !!savePlannedDates.error }}"}),[k]=m.useStateNumber({name:"changeoverHours",initialValue:3,inspector:"text",label:"Changeover Hours",description:"Hours for changeover between tests (work hours only)"}),[_]=m.useStateNumber({name:"workStart",initialValue:9,inspector:"text",label:"Work Start Hour"}),[O]=m.useStateNumber({name:"workEnd",initialValue:17,inspector:"text",label:"Work End Hour"}),[R]=m.useStateEnumeration({name:"defaultViewWeeks",initialValue:"4",enumDefinition:["2","4","8","12","24"],inspector:"segmented",label:"Default View"}),x=Number(R)||4,[W]=m.useStateString({name:"cardMainText",initialValue:"{name}",inspector:"text",label:"Card Title",description:"Template for card title. Use {fieldName} for data fields."}),[q]=m.useStateString({name:"cardSubText",initialValue:"Parts: {part_ready_date}",inspector:"text",label:"Card Subtitle",description:"Template for subtitle. Hidden when all fields are empty."}),[ee]=m.useStateString({name:"cardInfoRow",initialValue:"{owner} \xB7 {duration}h \xB7 P{priority}",inspector:"text",label:"Card Info Row",description:"Template for the info row shown on cards and bars."}),[Ne]=m.useStateString({name:"tooltipTemplate",initialValue:`Notes: {notes}
Owner: {owner}
Priority: {priority}
Part Status: {part_status}
Parts Due: {part_ready_date}
Assigned Parts: {assigned_parts}`,inspector:"text",label:"Tooltip Template",description:"Template for hover tooltip. Use \\n for newlines."}),[ue]=m.useStateArray({name:"statusOptions",initialValue:["NULL","Running","Created","Tested","Cancelled"],inspector:"text",label:"Status Options",description:"Status strings shown in the right-click Change Status menu. 'NULL' clears the status."}),[,te]=m.useStateArray({name:"allocations",initialValue:[],inspector:"hidden",description:"Current allocation state: [{test_id, test_stand_id, priority_order}]"}),[,De]=m.useStateArray({name:"allTestIds",initialValue:[],inspector:"hidden",description:"All test IDs managed by the scheduler (for the delete step in save)"}),[,ne]=m.useStateBoolean({name:"hasUnsavedChanges",initialValue:!1,inspector:"hidden",description:"Whether there are unsaved allocation changes"}),[,Y]=m.useStateString({name:"selectedTestId",initialValue:"",inspector:"hidden",description:"ID of test actioned via right-click menu (set before events fire)"}),[,C]=m.useStateString({name:"selectedTestPriority",initialValue:"",inspector:"hidden",description:"New priority value from Change Priority action (numeric string)"}),[,G]=m.useStateString({name:"selectedTestStatus",initialValue:"",inspector:"hidden",description:"New status from Change Status action. Empty string = NULL in DB."}),[,pe]=m.useStateArray({name:"plannedDates",initialValue:[],inspector:"hidden",description:"Array of {test_id, planned_date} for all stand-scheduled tests. Use with savePlannedDates query."}),Fe=m.useEventCallback({name:"onSave"}),we=m.useEventCallback({name:"onChange"}),et=m.useEventCallback({name:"onRetry"}),tt=m.useEventCallback({name:"onChangePriority"}),nt=m.useEventCallback({name:"onChangeStatus"}),ot=m.useEventCallback({name:"onEditTest"}),rt=m.useEventCallback({name:"onSavePlannedDates"});m.useComponentSettings({defaultHeight:600,defaultWidth:12});let[w,Ee]=s.default.useState([]),[I,Be]=s.default.useState([]),[oe,At]=s.default.useState(x||4),[y,Le]=s.default.useState(null),[_t,ge]=s.default.useState(null),[He,re]=s.default.useState(null),[V,Ce]=s.default.useState(!1),[Wt,Q]=s.default.useState(!1),[it,ie]=s.default.useState(!1),[A,U]=s.default.useState(null),[Oe,Ve]=s.default.useState(""),[st,Ue]=s.default.useState(!1),[fe,$e]=s.default.useState(!1),je=(0,s.useRef)(null),P=Wt||d||it,Te=st||f||fe;(0,s.useEffect)(()=>{d&&Q(!1),c?(Q(!1),ie(!0)):d||ie(!1)},[d,c]),(0,s.useEffect)(()=>{f&&Ue(!1),B?(Ue(!1),$e(!0)):f||$e(!1)},[f,B]),(0,s.useEffect)(()=>{if(!A)return;let e=l=>{je.current&&!je.current.contains(l.target)&&U(null)},a=l=>{l.key==="Escape"&&U(null)};return document.addEventListener("mousedown",e),document.addEventListener("keydown",a),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",a)}},[A]);let qe=(0,s.useRef)(""),at=s.default.useRef(""),lt=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=lt.current;if(!e)return;let a=new ResizeObserver(l=>{for(let g of l)Pt(g.contentRect.width||800)});return a.observe(e),()=>a.disconnect()},[]),(0,s.useEffect)(()=>{let e=p;if(!e||e===at.current)return;at.current=e;let a=Pe(w);qe.current=Je(a),Ce(!1),Q(!1),ie(!1)},[p,w]);let[It,Pt]=s.default.useState(800),[he,Mt]=s.default.useState("az"),[me,dt]=s.default.useState(""),zt=(0,s.useMemo)(()=>{let e=Array.isArray(ue)?ue:[];return e.length>0?e.map(String):["NULL","Running","Created","Tested","Cancelled"]},[ue]),Nt=(0,s.useMemo)(()=>JSON.stringify(t)+JSON.stringify(o),[t,o]);(0,s.useEffect)(()=>{let e=Array.isArray(t)?t:[],a=Array.isArray(o)?o:[];if(a.length===0&&e.length===0)return;let{stands:l,unallocated:g}=Rt(e,a,ke);Ee(l),Be(g),Ce(!1);let i=Pe(l);qe.current=Je(i),te(i),De(e.map(h=>h.id)),ne(!1),Q(!1),ie(!1)},[Nt]);let ke=k||3,$=_||9,j=O||17,D=(0,s.useMemo)(()=>{let e=new Date;for(e.setHours(0,0,0,0);e.getDay()!==1;)e.setDate(e.getDate()-1);return e},[]),ct=(0,s.useCallback)((e,a,l)=>{let g=e.filter(E=>Se(E)),i=e.filter(E=>!Se(E)),h=[...g].sort((E,z)=>{let N=Me(E.test_started_date)||new Date,J=Me(z.test_started_date)||new Date;return N.getTime()!==J.getTime()?N.getTime()-J.getTime():(z.priority??50)-(E.priority??50)}),S=new Date(D),b=h.map(E=>{let z=Me(E.test_started_date)||new Date(D),N=z<S?new Date(S):new Date(z),J=new Date(N.getTime()+E.duration*Z);return S=de(J,a,$,j),{...E,start:N,end:J}}),M=de(new Date,a,$,j),L=new Date(Math.max(S.getTime(),M.getTime())),Qe=i.map(E=>{let z=pn(new Date(L),E.duration,l),N=new Date(z.getTime()+E.duration*Z);return L=un(de(N,a,$,j),l),{...E,start:z,end:N}});return[...b,...Qe]},[D,$,j]),ye=(0,s.useMemo)(()=>new Map(w.map(e=>[e.id,ct(e.tests,e.changeover_hours,e.nonWorkingBlocks)])),[w,ct]),ut=(0,s.useMemo)(()=>{let e=new Date(D);return e.setDate(e.getDate()+oe*7),w.forEach(a=>{let l=ye.get(a.id)??[];if(l.length>0){let g=l[l.length-1],i=de(g.end,a.changeover_hours,$,j);i>e&&(e=i)}}),e.setDate(e.getDate()+7),e},[ye,w,D,oe,$,j]),se=(0,s.useMemo)(()=>Math.ceil(H(D,ut)/24),[D,ut]),K=(0,s.useMemo)(()=>{let e=[];return w.forEach(a=>{(ye.get(a.id)??[]).forEach(g=>{let i=g.start,h=`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`;e.push({test_id:g.id,planned_date:h})})}),e},[w,ye]);(0,s.useEffect)(()=>{pe(K)},[K]);let T=It/(oe*7*24),Ye=(0,s.useMemo)(()=>gn(D,se),[D,se]),Lt=(0,s.useMemo)(()=>fn(D,se),[D,se]),Re=se*24*T,ve=24*T,Ae=(0,s.useCallback)(e=>{let a=Pe(e),l=Je(a)!==qe.current;Ce(l),te(a),ne(l),r==="live"&&(Q(!0),we())},[r,te,ne,we]),be=(0,s.useCallback)(e=>{let a=I.find(l=>l.id===e);if(a)return a;for(let l of w){let g=l.tests.find(i=>i.id===e);if(g)return g}return null},[I,w]),ae=(0,s.useCallback)(()=>{Le(null),ge(null),re(null)},[]),_e=(0,s.useCallback)((e,a)=>{if(!y)return;let l=be(y);if(!l)return;Be(i=>i.filter(h=>h.id!==y));let g=w.map(i=>{let h=i.tests.filter(S=>S.id!==y);if(i.id===e){let S=[...h];return S.splice(a,0,l),{...i,tests:S}}return{...i,tests:h}});Ee(g),Ae(g),ae()},[y,be,w,Ae,ae]),Ge=(0,s.useCallback)(e=>{if(!y)return;let a=be(y);if(!a)return;let l=w.map(g=>({...g,tests:g.tests.filter(i=>i.id!==y)}));Be(g=>{let h=[...g.filter(S=>S.id!==y)];return h.splice(e,0,a),h}),Ee(l),Ae(l),ae()},[y,be,w,Ae,ae]),Ht=(0,s.useCallback)(()=>{Q(!0),Fe()},[Fe]),Ot=(0,s.useCallback)(()=>{Ue(!0),$e(!1),rt()},[rt]),pt=(0,s.useCallback)(()=>{ie(!1),Q(!1);let e=Array.isArray(t)?t:[],a=Array.isArray(o)?o:[],{stands:l,unallocated:g}=Rt(e,a,ke);Ee(l),Be(g),Ce(!1),te(Pe(l)),ne(!1)},[t,o,ke,te,ne]),Vt=(0,s.useCallback)(()=>{ie(!1),Q(!0),et()},[et]),Ut=(0,s.useCallback)(()=>U(null),[]),$t=(0,s.useCallback)(e=>{U(a=>a?{...a,mode:e}:null)},[]),jt=(0,s.useCallback)(()=>{if(!A)return;let e=parseInt(Oe,10);isNaN(e)||e<0||e>100||(Y(String(A.test.id)),C(String(e)),tt(),U(null))},[A,Oe,Y,C,tt]),qt=(0,s.useCallback)(e=>{A&&(Y(String(A.test.id)),G(e==="NULL"?"":e),nt(),U(null))},[A,Y,G,nt]),Yt=(0,s.useCallback)(()=>{A&&(Y(String(A.test.id)),ot(),U(null))},[A,Y,ot]),gt=(0,s.useCallback)((e,a)=>({left:Math.max(0,H(D,e))*T,width:Math.max(a*T,2)}),[D,T]),Gt=(0,s.useCallback)((e,a)=>{let l=Math.max(e.getTime(),D.getTime()),g=a.getTime();return g<=l?null:{left:H(D,new Date(l))*T,width:Math.max(H(new Date(l),new Date(g))*T,2)}},[D,T]),ft=y!=null?be(y):null,le=ft!=null?Se(ft):!1,ht=w.reduce((e,a)=>e+a.tests.length,0),Qt=w.reduce((e,a)=>e+a.tests.reduce((l,g)=>l+g.duration,0),0),mt=String(W||"{name}"),yt=String(q||""),vt=String(ee||""),bt=String(Ne||"").replace(/\\n/g,`
`),xt={Running:0,Delayed:1,"On Time":2,Ready:3,"In Progress":4,"Parts Not Assigned":5},Kt=(0,s.useMemo)(()=>{let e=[...I];if(me.trim()){let a=me.toLowerCase().trim();e=e.filter(l=>[l.name,l.owner,l.notes,l.status,l.part_status,l.assigned_parts,l.priority!=null?String(l.priority):"",l.duration!=null?String(l.duration):""].join(" ").toLowerCase().includes(a))}return he==="az"?e.sort((a,l)=>(a.name||"").localeCompare(l.name||"")):he==="priority"?e.sort((a,l)=>(l.priority??50)-(a.priority??50)):e.sort((a,l)=>{let g=xt[We(a)]??99,i=xt[We(l)]??99;return g!==i?g-i:(l.priority??50)-(a.priority??50)}),e},[I,he,me]),St=72,Dt=84;return u("div",{style:v.container,children:[n("style",{children:"@keyframes ccl-spin { to { transform: rotate(360deg); } }"}),P&&n(Dn,{isError:it,onRetry:Vt,onDiscard:pt}),u("div",{style:v.sidebar,children:[u("div",{style:{padding:"20px 16px 12px",borderBottom:"1px solid #E5E7EB"},children:[u("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:4},children:[u("div",{style:{display:"flex",alignItems:"center",gap:8},children:[n("div",{style:{width:8,height:8,borderRadius:"50%",background:I.length>0?"#F59E0B":"#10B981"}}),n("span",{style:{...v.mono,fontSize:13,fontWeight:700,letterSpacing:"0.08em",textTransform:"uppercase",color:"#4B5563"},children:"Queue"})]}),n("div",{style:{display:"flex",gap:2,background:"#F3F4F6",borderRadius:6,padding:2,border:"1px solid #E5E7EB"},children:[["az","A\u2192Z"],["priority","Priority"],["status","Status"]].map(([e,a])=>n("button",{onClick:()=>Mt(e),style:{...v.mono,padding:"3px 8px",fontSize:9,fontWeight:600,borderRadius:4,border:"none",cursor:"pointer",background:he===e?"#3B82F6":"transparent",color:he===e?"#FFF":"#6B7280"},children:a},e))})]}),u("div",{style:{position:"relative",marginTop:6},children:[n("input",{type:"text",value:me,onChange:e=>dt(e.target.value),placeholder:"Filter tests...",style:{...v.mono,width:"100%",boxSizing:"border-box",padding:"5px 28px 5px 8px",fontSize:11,border:"1px solid #E5E7EB",borderRadius:6,background:"#F9FAFB",color:"#111827",outline:"none"},onFocus:e=>{e.currentTarget.style.borderColor="#3B82F6",e.currentTarget.style.background="#FFFFFF"},onBlur:e=>{e.currentTarget.style.borderColor="#E5E7EB",e.currentTarget.style.background="#F9FAFB"}}),me&&n("button",{onClick:()=>dt(""),style:{position:"absolute",right:6,top:"50%",transform:"translateY(-50%)",background:"none",border:"none",cursor:"pointer",color:"#9CA3AF",fontSize:14,lineHeight:1,padding:0},children:"\xD7"})]})]}),u("div",{style:{flex:1,overflowY:"auto",padding:"8px 10px"},onDragOver:e=>{e.preventDefault(),e.target===e.currentTarget&&re(I.length)},onDragLeave:e=>{e.currentTarget===e.target&&re(null)},onDrop:e=>{e.preventDefault(),Ge(He??I.length)},children:[Kt.map((e,a)=>{let l=We(e,null),g=!ln(yt,e),i=X(mt,e),h=X(yt,e),S=X(vt,e);return u("div",{children:[n("div",{onDragOver:b=>{b.preventDefault(),b.stopPropagation(),re(a)},onDrop:b=>{b.preventDefault(),b.stopPropagation(),Ge(a)},style:{height:He===a&&y&&y!==e.id?6:0,background:"#3B82F6",borderRadius:3,transition:"height 0.12s ease"}}),n(kt,{testName:i,priority:e.priority,status:l,tooltipLines:X(bt,e),children:n(bn,{test:e,draggedTestId:y,status:l,mainText:i,subText:h,infoRow:S,showSub:g,onDragStart:()=>Le(e.id),onDragEnd:ae,onDragOver:b=>{b.preventDefault(),b.stopPropagation();let M=b.currentTarget.getBoundingClientRect();re(b.clientY<M.top+M.height/2?a:a+1)},onContextMenu:b=>{b.preventDefault(),b.stopPropagation(),!(y||P)&&(Ve(String(e.priority??50)),U({x:b.clientX,y:b.clientY,test:e,mode:"root"}))}})})]},e.id)}),n("div",{onDragOver:e=>{e.preventDefault(),re(I.length)},onDrop:e=>{e.preventDefault(),Ge(I.length)},style:{height:He===I.length&&y?6:0,background:"#3B82F6",borderRadius:3,transition:"height 0.12s ease",margin:"0 4px"}}),I.length===0&&n("div",{style:{textAlign:"center",padding:"32px 16px",color:"#6B7280",fontSize:12,border:y?"2px dashed #3B82F6":"2px dashed #D1D5DB",borderRadius:8,marginTop:8,background:y?"#EFF6FF":"transparent"},children:y?"Drop to return to queue":"All tests allocated"})]}),n(vn,{}),n("div",{style:{padding:"12px 16px",borderTop:"1px solid #E5E7EB",background:"#F9FAFB"},children:u("div",{style:{...v.mono,display:"flex",justifyContent:"space-between",fontSize:10,color:"#6B7280"},children:[u("span",{children:[ht,"/",ht+I.length," allocated"]}),u("span",{children:[Qt,"h"]})]})})]}),u("div",{style:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[u("div",{style:{padding:"12px 24px",borderBottom:"1px solid #E5E7EB",background:"#FFFFFF",display:"flex",alignItems:"center",justifyContent:"space-between",gap:16,flexWrap:"wrap"},children:[u("div",{style:{minWidth:0},children:[n("h1",{style:{fontSize:18,fontWeight:700,color:"#111827",letterSpacing:"-0.02em"},children:"Test Stand Scheduler"}),u("p",{style:{...v.mono,fontSize:11,color:"#6B7280",marginTop:2},children:["Continuous testing \xB7 ",ke,"h changeover (default) \xB7 ",$,":00\u2013",j,":00 Mon\u2013Fri",r==="live"&&n("span",{children:" \xB7 Live sync"})]})]}),u("div",{style:{display:"flex",alignItems:"center",gap:12},children:[r==="batch"&&u("div",{style:{display:"flex",gap:6},children:[n("button",{onClick:pt,disabled:!V||P,style:{...v.mono,padding:"6px 14px",fontSize:11,fontWeight:600,borderRadius:6,border:"1px solid #D1D5DB",cursor:V&&!P?"pointer":"default",background:"#FFFFFF",color:V&&!P?"#374151":"#9CA3AF",opacity:V&&!P?1:.5},children:"Discard"}),u("button",{onClick:Ht,disabled:!V||P,style:{...v.mono,padding:"6px 14px",fontSize:11,fontWeight:600,borderRadius:6,border:"none",cursor:V&&!P?"pointer":"default",background:V&&!P?"#3B82F6":"#93C5FD",color:"#FFFFFF",boxShadow:V&&!P?"0 1px 3px rgba(59,130,246,0.3)":"none"},children:["Save Changes",V&&" \u2022"]})]}),n("button",{onClick:Ot,disabled:Te||K.length===0,title:K.length===0?"No tests scheduled":`Save planned start dates for ${K.length} scheduled test${K.length!==1?"s":""}`,style:{...v.mono,padding:"6px 14px",fontSize:11,fontWeight:600,borderRadius:6,border:fe?"1px solid #FECACA":"1px solid #D1D5DB",cursor:!Te&&K.length>0?"pointer":"default",background:fe?"#FEF2F2":"#FFFFFF",color:fe?"#EF4444":Te?"#9CA3AF":"#374151",opacity:!Te&&K.length>0?1:.6,transition:"background 0.15s, color 0.15s, border-color 0.15s"},children:fe?"Error \u2014 Retry":st||f?"Saving\u2026":"Save Planned Dates"}),n("div",{style:{display:"flex",gap:4,background:"#F3F4F6",borderRadius:8,padding:3,border:"1px solid #E5E7EB"},children:[2,4,8,12,24].map(e=>u("button",{onClick:()=>At(e),style:{...v.mono,padding:"6px 12px",fontSize:11,fontWeight:600,borderRadius:6,border:"none",cursor:"pointer",background:oe===e?"#3B82F6":"transparent",color:oe===e?"#FFF":"#4B5563"},children:[e,"W"]},e))})]})]}),n("div",{ref:lt,style:{flex:1,overflow:"auto",background:"#F9FAFB"},children:u("div",{style:{minWidth:Re,padding:"0 12px 24px",position:"relative"},children:[u("div",{style:{position:"sticky",top:0,zIndex:20,background:"#F9FAFB",borderBottom:"1px solid #E5E7EB"},children:[n("div",{style:{display:"flex",height:28,position:"relative",borderBottom:"1px solid #E5E7EB"},children:Lt.map((e,a)=>n("div",{style:{...v.mono,position:"absolute",left:H(D,e)*T,width:7*24*T,height:28,display:"flex",alignItems:"center",paddingLeft:8,fontSize:10,fontWeight:600,color:"#4B5563",borderLeft:a>0?"1px solid #E5E7EB":"none"},children:hn(e)},a))}),n("div",{style:{display:"flex",height:24},children:Ye.map((e,a)=>{let l=e.toDateString()===new Date().toDateString(),g=e.getDay()===0||e.getDay()===6;return n("div",{style:{...v.mono,width:ve,minWidth:ve,fontSize:9,textAlign:"center",color:l?"#2563EB":"#6B7280",fontWeight:l?700:400,lineHeight:"24px",borderLeft:"1px solid #E5E7EB",background:l?"#EFF6FF":g?"#F3F4F6":"transparent"},children:oe<=8||e.getDay()===1?e.getDate():""},a)})})]}),w.map(e=>{let a=ye.get(e.id)??[],l=_t,g=l&&l.standId===e.id;return u("div",{style:{marginTop:16},children:[u("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6,paddingLeft:2},children:[n("div",{style:{width:6,height:6,borderRadius:2,background:e.tests.length>0?"#3B82F6":"#9CA3AF"}}),n("span",{style:{...v.mono,fontSize:11,fontWeight:600,color:"#374151"},children:e.name}),u("span",{style:{...v.mono,fontSize:10,color:"#6B7280"},children:[e.tests.length," test",e.tests.length!==1?"s":"",e.tests.length>0&&` \xB7 ${e.tests.reduce((i,h)=>i+h.duration,0)}h`]})]}),u("div",{onDragOver:i=>{i.preventDefault(),ge({standId:e.id,index:e.tests.length})},onDragLeave:i=>{i.currentTarget.contains(i.relatedTarget)||ge(null)},onDrop:i=>{i.preventDefault(),le?_e(e.id,e.tests.length):_e(e.id,l?.standId===e.id?l.index:e.tests.length)},style:{position:"relative",height:Dt,background:(()=>g||y&&e.tests.length===0?le?"#F5F3FF":"#EFF6FF":"#F3F4F6")(),border:`1px solid ${(()=>g||y&&e.tests.length===0?le?"#A78BFA":"#BFDBFE":"#E5E7EB")()}`,borderRadius:8,width:Re,transition:"background 0.15s ease, border-color 0.15s ease"},children:[Ye.map((i,h)=>i.getDay()!==0&&i.getDay()!==6?null:n("div",{style:{position:"absolute",left:h*ve,top:0,bottom:0,width:ve,background:"#E5E7EB",pointerEvents:"none"}},`we-${h}`)),Ye.map((i,h)=>n("div",{style:{position:"absolute",left:h*ve,top:0,bottom:0,width:1,background:"#E5E7EB"}},h)),(()=>{let i=H(D,new Date);return i<0||i>se*24?null:n("div",{style:{position:"absolute",left:i*T,top:0,bottom:0,width:2,background:"#EF4444",zIndex:10},children:n("div",{style:{position:"absolute",top:-3,left:-3,width:8,height:8,borderRadius:"50%",background:"#EF4444"}})})})(),e.nonWorkingBlocks.map((i,h)=>{let S=H(D,i.start)*T,b=H(i.start,i.end)*T;if(S+b<0||S>Re)return null;let M=Math.max(0,S),L=Math.min(b+Math.min(0,S),Re-M);return u("div",{style:{position:"absolute",left:M,top:6,width:L,height:St,zIndex:6,pointerEvents:"none",background:"repeating-linear-gradient(45deg, #E5E7EB 0px, #E5E7EB 15px, #FFFFFF 15px, #FFFFFF 30px)",borderRadius:8,border:"1px solid #D1D5DB",display:"flex",flexDirection:"row",overflow:"hidden"},children:[n("div",{style:{width:5,minWidth:5,background:"#9CA3AF",flexShrink:0}}),n("div",{style:{flex:1,display:"flex",flexDirection:"column",padding:"4px 8px",minWidth:0,justifyContent:"center"},children:n("span",{style:{fontSize:12,fontWeight:700,color:"#374151",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%",lineHeight:1.2},children:i.notes||"Maintenance"})})]},`nw-${h}`)}),a.map((i,h)=>{let S=Se(i),b=S?Gt(i.start,i.end):gt(i.start,i.duration);if(!b)return null;let{left:M,width:L}=b,Qe=de(i.end,e.changeover_hours,$,j),E=H(i.end,Qe)*T,z=We(i,i.start),N=X(mt,i),J=X(vt,i),Jt=J.trim()!==""&&L>120;return u("div",{style:{position:"absolute",left:M,top:0,width:L+E,height:"100%"},children:[y&&y!==i.id&&!le&&u(xe,{children:[n("div",{onDragOver:F=>{F.preventDefault(),F.stopPropagation(),ge({standId:e.id,index:h})},onDrop:F=>{F.preventDefault(),F.stopPropagation(),_e(e.id,h)},style:{position:"absolute",left:-6,top:0,width:"50%",height:"100%",zIndex:20,minWidth:20}}),n("div",{onDragOver:F=>{F.preventDefault(),F.stopPropagation(),ge({standId:e.id,index:h+1})},onDrop:F=>{F.preventDefault(),F.stopPropagation(),_e(e.id,h+1)},style:{position:"absolute",right:-6,top:0,width:"50%",height:"100%",zIndex:20,minWidth:20}})]}),g&&!le&&l.index===h&&n("div",{style:{position:"absolute",left:-4,top:0,bottom:0},children:n(Tt,{})}),n(kt,{testName:N,priority:i.priority,status:z,tooltipLines:X(bt,i),scheduled:S?null:i,wrapperStyle:{position:"absolute",left:0,top:0,width:L,height:"100%"},children:n(xn,{test:i,isTestRunning:S,draggedTestId:y,width:L,BAR_HEIGHT:St,displayStatus:z,resolvedMain:N,resolvedInfo:J,showInfoOnBar:Jt,onDragStart:F=>{F.dataTransfer.effectAllowed="move",F.dataTransfer.setData("text/plain",String(i.id)),Le(i.id)},onDragEnd:ae,onContextMenu:F=>{F.preventDefault(),F.stopPropagation(),!(y||P)&&(Ve(String(i.priority??50)),U({x:F.clientX,y:F.clientY,test:i,mode:"root"}))}})}),h<a.length&&E>0&&n("div",{style:{position:"absolute",left:L,top:Dt/2-8,width:E,height:16,display:"flex",alignItems:"center",justifyContent:"center"},children:n("div",{style:{height:1,width:"80%",background:"repeating-linear-gradient(90deg, #9CA3AF 0, #9CA3AF 4px, transparent 4px, transparent 8px)"}})})]},i.id)}),g&&!le&&l.index===e.tests.length&&a.length>0&&(()=>{let i=a[a.length-1],{left:h,width:S}=gt(i.start,i.duration),b=de(i.end,e.changeover_hours,$,j),M=H(i.end,b)*T;return n("div",{style:{position:"absolute",left:h+S+M+8,top:0,bottom:0},children:n(Tt,{})})})(),e.tests.length===0&&n("div",{style:{...v.mono,position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:11,color:y?"#3B82F6":"#9CA3AF",fontWeight:y?600:400},children:y?"Drop here to schedule":"Drop tests here to schedule"})]})]},e.id)}),w.length===0&&n("div",{style:{...v.mono,textAlign:"center",padding:"48px 24px",color:"#6B7280",fontSize:12},children:"No test stands loaded. Bind the testStands property to your getTestStands query."})]})})]}),A&&n(Sn,{menu:A,statusOptionsList:zt,priorityInputValue:Oe,onClose:Ut,onModeChange:$t,onPriorityInputChange:Ve,onConfirmPriority:jt,onPickStatus:qt,onEditTest:Yt,panelRef:je})]})};export{Rn as TestStandScheduler};
